<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cyrus&#39; blog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-04-09T04:34:43.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Cyrus</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS KVO(é”®å€¼è§‚å¯Ÿ) æ€»è§ˆ</title>
    <link href="http://yoursite.com/2016/04/07/iOS-KVO-%E9%94%AE%E5%80%BC%E8%A7%82%E5%AF%9F-%E6%80%BB%E8%A7%88/"/>
    <id>http://yoursite.com/2016/04/07/iOS-KVO-é”®å€¼è§‚å¯Ÿ-æ€»è§ˆ/</id>
    <published>2016-04-07T13:59:28.000Z</published>
    <updated>2016-04-09T04:34:43.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrpns.com1.z0.glb.clouddn.com/heading-KVO.png" alt=""></p>
<p>æœ¬æ–‡ä¸»è¦å†…å®¹æ¥è‡ªäºå¯¹å®˜æ–¹æ–‡æ¡£ <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html#//apple_ref/doc/uid/10000177-BCICJDHA" target="_blank" rel="external">Key-Value Observing Programming Guide</a> çš„ç¿»è¯‘ï¼Œä»¥åŠä¸€éƒ¨åˆ†æˆ‘è‡ªå·±çš„ç†è§£å’Œè§£é‡Šï¼Œå¦‚æœæœ‰è¯´é”™çš„åœ°æ–¹è¯·åŠæ—¶è”ç³»æˆ‘ã€‚</p>
<h2 id="At-a-Glance"><a href="#At-a-Glance" class="headerlink" title="At a Glance"></a>At a Glance</h2><p>KVO ä¹Ÿå°±æ˜¯ é”®å€¼è§‚å¯Ÿ ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—å½“æŸä¸ªå¯¹è±¡ç‰¹å®šçš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶èƒ½å¤Ÿé€šçŸ¥åˆ°åˆ«çš„å¯¹è±¡ã€‚è¿™ç»å¸¸ç”¨äº model å’Œ controller ä¹‹é—´çš„é€šä¿¡ã€‚KVOä¸»è¦çš„ä¼˜ç‚¹æ˜¯ä½ ä¸éœ€è¦åœ¨æ¯æ¬¡å±æ€§æ”¹å˜æ—¶æ‰‹åŠ¨å»å‘é€é€šçŸ¥ã€‚å¹¶ä¸”å®ƒæ”¯æŒä¸ºä¸€ä¸ªå±æ€§æ³¨å†Œå¤šä¸ªè§‚å¯Ÿè€…ã€‚</p>
<h2 id="æ³¨å†Œ-KVO"><a href="#æ³¨å†Œ-KVO" class="headerlink" title="æ³¨å†Œ KVO"></a>æ³¨å†Œ KVO</h2><ul>
<li><strong>è¢«è§‚å¯Ÿå¯¹è±¡</strong> çš„å±æ€§å¿…é¡»æ˜¯ <a href="file:///Users/hcy/Library/Developer/Shared/Documentation/DocSets/com.apple.adc.documentation.iOS.docset/Contents/Resources/Documents/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-BAJEAIEE" target="_blank" rel="external">KVO Compliant</a></li>
<li>å¿…é¡»ç”¨ <strong>è¢«è§‚å¯Ÿå¯¹è±¡</strong> çš„ <code>addObserver:forKeyPath:options:context:</code> æ–¹æ³•æ³¨å†Œè§‚å¯Ÿè€…</li>
<li><strong>è§‚å¯Ÿè€…</strong> å¿…é¡»å®ç° <code>observeValueForKeyPath:ofObject:change:context:</code> æ–¹æ³•</li>
</ul>
<a id="more"></a>
<h3 id="æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…"><a href="#æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…" class="headerlink" title="æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…"></a>æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…</h3><hr>
<p>ä¸ºäº†èƒ½å¤Ÿåœ¨å±æ€§æ”¹å˜æ—¶è¢«é€šçŸ¥åˆ°ï¼Œä¸€ä¸ª <strong>è§‚å¯Ÿè€…å¯¹è±¡</strong> å¿…é¡»é€šè¿‡ <strong>è¢«è§‚å¯Ÿå¯¹è±¡</strong> çš„<code>addObserver:forKeyPath:options:context:</code> æ–¹æ³•æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…ã€‚</p>
<ul>
<li><code>observer</code> å‚æ•°ä¹Ÿå°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡</li>
<li><code>keyPath</code>  è¡¨ç¤ºè¦è§‚å¯Ÿçš„å±æ€§</li>
<li><p><code>options</code>  å†³å®šäº†æä¾›ç»™è§‚å¯Ÿè€…changeå­—å…¸ä¸­çš„å…·ä½“ä¿¡æ¯æœ‰å“ªäº›ã€‚ï¼ˆchangeå­—å…¸æ˜¯ä¸€ä¸ªæä¾›ç»™è§‚å¯Ÿè€…çš„å‚æ•°ï¼Œåé¢ä¼šæåˆ°ï¼‰</p>
<ul>
<li><code>NSKeyValueObservingOptionOld</code> è¡¨ç¤ºåœ¨changeå­—å…¸ä¸­åŒ…å«äº†æ”¹å˜å‰çš„å€¼ã€‚  </li>
<li><code>NSKeyValueObservingOptionNew</code> è¡¨ç¤ºåœ¨changeå­—å…¸ä¸­åŒ…å«æ–°çš„å€¼ã€‚</li>
<li><code>NSKeyValueObservingOptionInitial</code> åœ¨æ³¨å†Œè§‚å¯Ÿè€…çš„æ–¹æ³•returnçš„æ—¶å€™å°±ä¼šå‘å‡ºä¸€æ¬¡é€šçŸ¥ã€‚</li>
<li><code>NSKeyValueObservingOptionPrior</code> ä¼šåœ¨å€¼å‘ç”Ÿæ”¹å˜å‰å‘å‡ºä¸€æ¬¡é€šçŸ¥ï¼Œå½“ç„¶æ”¹å˜åçš„é€šçŸ¥ä¾æ—§è¿˜ä¼šå‘å‡ºï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡changeéƒ½ä¼šæœ‰ä¸¤ä¸ªé€šçŸ¥ã€‚</li>
</ul>
</li>
<li><p><code>context</code> è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ª CæŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª å¯¹è±¡å¼•ç”¨ï¼Œå®ƒå¯ä»¥ä½œä¸ºè¿™ä¸ªcontextçš„å”¯ä¸€æ ‡è¯†ï¼Œä¹Ÿå¯ä»¥æä¾›ä¸€äº›æ•°æ®ç»™è§‚å¯Ÿè€…ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š  <code>addObserver:forKeyPath:options:context:</code> æ–¹æ³•ä¸ä¼šæŒæœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡ï¼Œä»¥åŠcontextçš„å¼ºå¼•ç”¨ã€‚ä½ è¦ç¡®ä¿è‡ªå·±æŒæœ‰äº†ä»–ä»¬çš„å¼ºå¼•ç”¨ã€‚</p>
</blockquote>
<h3 id="å±æ€§å˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥"><a href="#å±æ€§å˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥" class="headerlink" title="å±æ€§å˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥"></a>å±æ€§å˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥</h3><hr>
<p>å½“ä¸€ä¸ªè¢«è§‚å¯Ÿå±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿè€…ä¼šæ”¶åˆ° <code>observeValueForKeyPath:ofObject:change:context:</code> çš„æ¶ˆæ¯ã€‚æ‰€æœ‰çš„è§‚å¯Ÿè€…å¿…é¡»å®ç°è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸­çš„å‚æ•°å’Œæ³¨å†Œè§‚å¯Ÿè€…æ–¹æ³•çš„å‚æ•°åŸºæœ¬ç›¸åŒï¼Œåªæœ‰ä¸€ä¸ª <code>change</code> ä¸åŒã€‚ <code>change</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒé‡Œé¢åŒ…å«äº†çš„ä¿¡æ¯ç”±æ³¨å†Œæ—¶çš„ <code>options</code> å†³å®šã€‚</p>
<p>å®˜æ–¹æä¾›äº†è¿™äº›keyç»™æˆ‘ä»¬æ¥å–åˆ° <code>change</code> ä¸­çš„valueï¼š </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">NSKeyValueChangeKindKey</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">NSKeyValueChangeNewKey</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">NSKeyValueChangeOldKey</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">NSKeyValueChangeIndexesKey</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">NSKeyValueChangeNotificationIsPriorKey</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong><code>NSKeyValueChangeKindKey</code></strong> è¿™ä¸ªkeyåŒ…å«çš„valueæ˜¯ä¸€ä¸ª NSNumber é‡Œé¢æ˜¯ä¸€ä¸ª intï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ <code>NSKeyValueChange</code> çš„æšä¸¾</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">   <span class="built_in">NSKeyValueChangeSetting</span> = <span class="number">1</span>,</span><br><span class="line">   <span class="built_in">NSKeyValueChangeInsertion</span> = <span class="number">2</span>,</span><br><span class="line">   <span class="built_in">NSKeyValueChangeRemoval</span> = <span class="number">3</span>,</span><br><span class="line">   <span class="built_in">NSKeyValueChangeReplacement</span> = <span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NSUInteger</span> <span class="built_in">NSKeyValueChange</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å½“ <code>change[NSKeyValueChangeKindKey]</code> æ˜¯ <code>NSKeyValueChangeSetting</code> çš„æ—¶å€™ï¼Œè¯´æ˜è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•è¢«è°ƒç”¨äº†ã€‚<br>è€Œä¸‹é¢ä¸‰ç§ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æ„æ€æ˜¯ï¼Œå½“è¢«è§‚å¯Ÿå±æ€§æ˜¯é›†åˆç±»å‹ï¼Œä¸”å¯¹å®ƒè¿›è¡Œäº† insertï¼Œremoveï¼Œreplace æ“ä½œçš„æ—¶å€™ä¼šè¿”å›è¿™ä¸‰ç§Keyï¼Œä½†æ˜¯æˆ‘è‡ªå·±æµ‹è¯•çš„æ—¶å€™æ²¡æœ‰æµ‹è¯•å‡ºæ¥ğŸ˜“ä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘ç†è§£é”™äº†ã€‚</p>
<ul>
<li><p><strong><code>NSKeyValueChangeNewKey</code></strong>ï¼Œ<strong><code>NSKeyValueChangeOldKey</code></strong> é¡¾åæ€ä¹‰ï¼Œå½“ä½ åœ¨æ³¨å†Œçš„æ—¶å€™ <code>options</code> å‚æ•°ä¸­å¡«äº†å¯¹åº”çš„ <code>NSKeyValueObservingOptionNew</code> å’Œ <code>NSKeyValueObservingOptionOld</code> ï¼Œå¹¶ä¸” <code>NSKeyValueChangeKindKey</code> çš„å€¼æ˜¯ <code>NSKeyValueChangeSetting</code> ï¼Œä½ å°±å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªkeyå–åˆ° æ—§å€¼å’Œæ–°å€¼ã€‚</p>
</li>
<li><p><strong><code>NSKeyValueChangeIndexesKey</code></strong>ï¼Œ å½“ <code>NSKeyValueChangeKindKey</code> çš„ç»“æœæ˜¯ <code>NSKeyValueChangeInsertion</code>, <code>NSKeyValueChangeRemoval</code> æˆ– <code>NSKeyValueChangeReplacement</code> çš„æ—¶å€™ï¼Œè¿™ä¸ªkeyçš„valueæ˜¯ä¸€ä¸ªNSIndexSetï¼ŒåŒ…å«äº†å‘ç”Ÿinsertï¼Œremoveï¼Œreplaceçš„å¯¹è±¡çš„ç´¢å¼•é›†åˆ</p>
</li>
<li><p><strong><code>NSKeyValueChangeNotificationIsPriorKey</code></strong>ï¼Œè¿™ä¸ªkeyåŒ…å«äº†ä¸€ä¸ª NSNumberï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœåœ¨æ³¨å†Œæ—¶ <code>options</code> ä¸­æœ‰ <code>NSKeyValueObservingOptionPrior</code>ï¼Œé‚£ä¹ˆåœ¨å‰ä¸€ä¸ªé€šçŸ¥ä¸­çš„ <code>change</code> ä¸­å°±ä¼šæœ‰è¿™ä¸ªkeyçš„valueï¼Œ æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨æ”¹å˜å‰çš„é€šçŸ¥<code>[change[NSKeyValueChangeNotificationIsPriorKey] boolValue] == YES;</code></p>
</li>
</ul>
<h3 id="ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…"><a href="#ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…" class="headerlink" title="ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…"></a>ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…</h3><hr>
<p>ä½ å¯ä»¥é€šè¿‡ <code>removeObserver:forKeyPath:</code> æ–¹æ³•æ¥ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿã€‚å¦‚æœä½ çš„ <code>context</code> æ˜¯ä¸€ä¸ª å¯¹è±¡ï¼Œä½ å¿…é¡»åœ¨ç§»é™¤è§‚å¯Ÿä¹‹å‰æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ã€‚å½“ç§»é™¤äº†è§‚å¯Ÿåï¼Œè§‚å¯Ÿè€…å¯¹è±¡å†ä¹Ÿä¸ä¼šå—åˆ°è¿™ä¸ª keyPath çš„é€šçŸ¥ã€‚</p>
<h2 id="KVO-Compliance"><a href="#KVO-Compliance" class="headerlink" title="KVO Compliance"></a>KVO Compliance</h2><p>æœ‰ä¸¤ç§æ–¹å¼èƒ½å¤Ÿä¿è¯ change notification èƒ½å¤Ÿè¢«å‘å‡ºã€‚</p>
<ul>
<li>è‡ªåŠ¨é€šçŸ¥ï¼Œç»§æ‰¿è‡ªNSObjectï¼Œå¹¶ä¸”æ‰€æœ‰çš„å±æ€§ç¬¦åˆ<a href="file:///Users/hcy/Library/Developer/Shared/Documentation/DocSets/com.apple.adc.documentation.iOS.docset/Contents/Resources/Documents/documentation/Cocoa/Conceptual/KeyValueCoding/Articles/Compliant.html#//apple_ref/doc/uid/20002172" target="_blank" rel="external">KVCè§„èŒƒ</a>è¿™æ ·å°±ä¸ç”¨å†™é¢å¤–çš„ä»£ç å»å®ç°è‡ªåŠ¨é€šçŸ¥ã€‚</li>
<li>æ‰‹åŠ¨é€šçŸ¥ï¼Œè®©ä½ çš„å­ç±»å®ç° <code>automaticallyNotifiesObserversForKey:</code> æ–¹æ³•ï¼Œæ¥å†³å®šæ˜¯å¦éœ€è¦è‡ªåŠ¨é€šçŸ¥ï¼Œå¦‚æœæ˜¯æ‰‹åŠ¨é€šçŸ¥éœ€è¦é¢å¤–çš„ä»£ç ã€‚</li>
</ul>
<h3 id="è‡ªåŠ¨é€šçŸ¥"><a href="#è‡ªåŠ¨é€šçŸ¥" class="headerlink" title="è‡ªåŠ¨é€šçŸ¥"></a>è‡ªåŠ¨é€šçŸ¥</h3><hr>
<p> NSObject å·²ç»å®ç°äº†è‡ªåŠ¨é€šçŸ¥ï¼Œåªè¦é€šè¿‡ setter æ–¹æ³•å»èµ‹å€¼ï¼Œæˆ–è€…é€šè¿‡ KVC å°±å¯ä»¥é€šçŸ¥åˆ°è§‚å¯Ÿè€…ã€‚è‡ªåŠ¨é€šçŸ¥ä¹Ÿæ”¯æŒé›†åˆä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚ mutableArrayValueForKey: æ–¹æ³•ã€‚</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// Call the accessor method.</span></span><br><span class="line">[account setName:<span class="string">@"Savings"</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Use setValue:forKey:.</span></span><br><span class="line">[account setValue:<span class="string">@"Savings"</span> forKey:<span class="string">@"name"</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Use a key path, where 'account' is a kvc-compliant property of 'document'.</span></span><br><span class="line">[document setValue:<span class="string">@"Savings"</span> forKeyPath:<span class="string">@"account.name"</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Use mutableArrayValueForKey: to retrieve a relationship proxy object.</span></span><br><span class="line">Transaction *newTransaction = &lt;<span class="meta">#Create a new transaction for the account#&gt;;</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *transactions = [account mutableArrayValueForKey:<span class="string">@"transactions"</span>];</span><br><span class="line">[transactions addObject:newTransaction];</span><br></pre></td></tr></table></figure>
<h3 id="æ‰‹åŠ¨é€šçŸ¥"><a href="#æ‰‹åŠ¨é€šçŸ¥" class="headerlink" title="æ‰‹åŠ¨é€šçŸ¥"></a>æ‰‹åŠ¨é€šçŸ¥</h3><hr>
<p> æ‰‹åŠ¨é€šçŸ¥æä¾›äº†æ›´è‡ªç”±çš„æ–¹å¼å»å†³å®šä»€ä¹ˆæ—¶é—´ï¼Œä»€ä¹ˆæ–¹å¼å»é€šçŸ¥è§‚å¯Ÿè€…ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ æœ€å°‘é™åº¦è§¦å‘ä¸å¿…è¦çš„é€šçŸ¥ï¼Œæˆ–è€…ä¸€ç»„æ”¹å˜å€¼å‘å‡ºä¸€ä¸ªé€šçŸ¥ã€‚æƒ³è¦ä½¿ç”¨æ‰‹åŠ¨é€šçŸ¥å¿…é¡»å®ç°<code>automaticallyNotifiesObserversForKey:</code> æ–¹æ³•ã€‚(æˆ–è€…<code>automaticallyNotifiesObserversOfS&lt;Key&gt;</code>)åœ¨ä¸€ä¸ªç±»ä¸­åŒæ—¶ä½¿ç”¨è‡ªåŠ¨å’Œæ‰‹åŠ¨é€šçŸ¥æ˜¯å¯è¡Œçš„ã€‚å¯¹äºæƒ³è¦æ‰‹åŠ¨é€šçŸ¥çš„å±æ€§ï¼Œå¯ä»¥æ ¹æ®å®ƒçš„keyPathè¿”å›NOï¼Œè€Œå…¶å¯¹äºå…¶ä»–ä½ç½®çš„keyPathï¼Œè¦è¿”å›çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> + (<span class="built_in">BOOL</span>)automaticallyNotifiesObserversForKey:(<span class="built_in">NSString</span> *)theKey &#123;</span><br><span class="line">    	<span class="built_in">BOOL</span> automatic = <span class="literal">NO</span>;</span><br><span class="line">    	<span class="keyword">if</span> ([theKey isEqualToString:<span class="string">@"openingBalance"</span>]) &#123;</span><br><span class="line">    	    automatic = <span class="literal">NO</span>;</span><br><span class="line">   		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     	    automatic = [<span class="keyword">super</span> automaticallyNotifiesObserversForKey:theKey];</span><br><span class="line">   	 	&#125;</span><br><span class="line">   	 	<span class="keyword">return</span> automatic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> è¦å®ç°æ‰‹åŠ¨é€šçŸ¥ï¼Œä½ éœ€è¦åœ¨å€¼æ”¹å˜å‰è°ƒç”¨ <code>willChangeValueForKey:</code> æ–¹æ³•ï¼Œåœ¨å€¼æ”¹å˜åè°ƒç”¨ <code>didChangeValueForKey:</code> æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨å‘é€é€šçŸ¥å‰æ£€æŸ¥å€¼æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜å°±ä¸å‘é€é€šçŸ¥</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="keyword">void</span>)setOpeningBalance:(<span class="keyword">double</span>)theBalance &#123;</span><br><span class="line">    	<span class="keyword">if</span> (theBalance != _openingBalance) &#123;</span><br><span class="line">       	 [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"openingBalance"</span>];</span><br><span class="line">       	 _openingBalance = theBalance;</span><br><span class="line">       	 [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"openingBalance"</span>];</span><br><span class="line">   	 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> å¦‚æœä¸€ä¸ªæ“ä½œä¼šå¯¼è‡´å¤šä¸ªå±æ€§æ”¹å˜ï¼Œä½ éœ€è¦åµŒå¥—é€šçŸ¥ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="keyword">void</span>)setOpeningBalance:(<span class="keyword">double</span>)theBalance &#123;</span><br><span class="line">    	[<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"openingBalance"</span>];</span><br><span class="line">    	[<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"itemChanged"</span>];</span><br><span class="line">   	 	_openingBalance = theBalance;</span><br><span class="line">    	_itemChanged = _itemChanged+<span class="number">1</span>;</span><br><span class="line">    	[<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"itemChanged"</span>];</span><br><span class="line">    	[<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"openingBalance"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> åœ¨ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³ç³»ä¸­ï¼Œä½ å¿…é¡»æ³¨æ„ä¸ä»…ä»…æ˜¯è¿™ä¸ªkeyæ”¹å˜äº†ï¼Œè¿˜æœ‰å®ƒæ”¹å˜çš„ç±»å‹ä»¥åŠç´¢å¼•ã€‚</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="keyword">void</span>)removeTransactionsAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes &#123;</span><br><span class="line">    	[<span class="keyword">self</span> willChange:<span class="built_in">NSKeyValueChangeRemoval</span> valuesAtIndexes:indexes forKey:<span class="string">@"transactions"</span>];</span><br><span class="line"> </span><br><span class="line">	   	<span class="comment">// Remove the transaction objects at the specified indexes.</span></span><br><span class="line"> </span><br><span class="line">    	[<span class="keyword">self</span> didChange:<span class="built_in">NSKeyValueChangeRemoval</span> valuesAtIndexes:indexes forKey:<span class="string">@"transactions"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é”®ä¹‹é—´çš„ä¾èµ–"><a href="#é”®ä¹‹é—´çš„ä¾èµ–" class="headerlink" title="é”®ä¹‹é—´çš„ä¾èµ–"></a>é”®ä¹‹é—´çš„ä¾èµ–</h2><p>åœ¨å¾ˆå¤šç§æƒ…å†µä¸‹ä¸€ä¸ªå±æ€§çš„å€¼ä¾èµ–äºåœ¨å…¶ä»–å¯¹è±¡ä¸­çš„å±æ€§ã€‚å¦‚æœä¸€ä¸ªä¾èµ–å±æ€§çš„å€¼æ”¹å˜äº†ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿéœ€è¦è¢«é€šçŸ¥åˆ°ã€‚</p>
<h3 id="To-one-Relationships"><a href="#To-one-Relationships" class="headerlink" title="To-one Relationships"></a>To-one Relationships</h3><hr>
<p>æ¯”å¦‚æœ‰ä¸€ä¸ªæ•™ <code>fullName</code> çš„å±æ€§ï¼Œä¾èµ–äº <code>firstName</code> å’Œ <code>lastName</code>ï¼Œå½“ <code>firstName</code> æˆ–è€… <code>lastName</code> æ”¹å˜æ—¶ï¼Œè¿™ä¸ª <code>fullName</code> å±æ€§éœ€è¦è¢«é€šçŸ¥åˆ°ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)fullName &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@ %@"</span>,firstName, lastName];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥é‡å†™ <code>keyPathsForValuesAffectingValueForKey:</code> æ–¹æ³•ã€‚å…¶ä¸­è¦å…ˆè°ƒçˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•æ‹¿åˆ°ä¸€ä¸ªsetï¼Œå†åšæ¥ä¸‹æ¥çš„æ“ä½œã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingValueForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">NSSet</span> *keyPaths = [<span class="keyword">super</span> keyPathsForValuesAffectingValueForKey:key];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"fullName"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSArray</span> *affectingKeys = @[<span class="string">@"lastName"</span>, <span class="string">@"firstName"</span>];</span><br><span class="line">        keyPaths = [keyPaths setByAddingObjectsFromArray:affectingKeys];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keyPaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç° <code>keyPathsForValuesAffecting&lt;Key&gt;</code> æ–¹æ³•æ¥è¾¾åˆ°å‰é¢åŒæ ·çš„æ•ˆæœï¼Œè¿™é‡Œçš„<key>å°±æ˜¯å±æ€§åï¼Œä¸è¿‡ç¬¬ä¸€ä¸ªå­—æ¯è¦å¤§å†™ï¼Œç”¨å‰é¢çš„ä¾‹å­æ¥è¯´å°±æ˜¯è¿™æ ·ï¼š</key></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingFullName &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"lastName"</span>, <span class="string">@"firstName"</span>, <span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="To-many-Relationships"><a href="#To-many-Relationships" class="headerlink" title="To-many Relationships"></a>To-many Relationships</h3><hr>
<p><code>keyPathsForValuesAffectingValueForKey:</code>æ–¹æ³•ä¸èƒ½æ”¯æŒ to-many çš„å…³ç³»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ æœ‰ä¸€ä¸ª Department å¯¹è±¡ï¼Œå’Œå¾ˆå¤šä¸ª Employee å¯¹è±¡ã€‚è€Œ Employee æœ‰ä¸€ä¸ª salary å±æ€§ã€‚ä½ å¯èƒ½å¸Œæœ› Department å¯¹è±¡æœ‰ä¸€ä¸ª totalSalary çš„å±æ€§ï¼Œä¾èµ–äºæ‰€æœ‰çš„ Employee çš„ salary ã€‚</p>
<p>ä½ å¯ä»¥æ³¨å†Œ Department æˆä¸ºæ‰€æœ‰ Employee çš„è§‚å¯Ÿè€…ã€‚å½“ Employee è¢«æ·»åŠ æˆ–è€…è¢«ç§»é™¤æ—¶ï¼Œä½ å¿…é¡»è¦æ·»åŠ å’Œç§»é™¤è§‚å¯Ÿè€…ã€‚ç„¶ååœ¨ <code>observeValueForKeyPath:ofObject:change:context:</code> æ–¹æ³•ä¸­ï¼Œæ ¹æ®æ”¹å˜åšå‡ºåé¦ˆã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> (context == totalSalaryContext) &#123;</span><br><span class="line">        [<span class="keyword">self</span> updateTotalSalary];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="comment">// deal with other observations and/or invoke super...</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (<span class="keyword">void</span>)updateTotalSalary &#123;</span><br><span class="line">    [<span class="keyword">self</span> setTotalSalary:[<span class="keyword">self</span> valueForKeyPath:<span class="string">@"employees.@sum.salary"</span>]];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (<span class="keyword">void</span>)setTotalSalary:(<span class="built_in">NSNumber</span> *)newTotalSalary &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (totalSalary != newTotalSalary) &#123;</span><br><span class="line">        [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"totalSalary"</span>];</span><br><span class="line">        _totalSalary = newTotalSalary;</span><br><span class="line">        [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"totalSalary"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (<span class="built_in">NSNumber</span> *)totalSalary &#123;</span><br><span class="line">    <span class="keyword">return</span> _totalSalary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="KVOçš„å®ç°ç»†èŠ‚"><a href="#KVOçš„å®ç°ç»†èŠ‚" class="headerlink" title="KVOçš„å®ç°ç»†èŠ‚"></a>KVOçš„å®ç°ç»†èŠ‚</h2><p>KVO çš„å®ç°ç”¨äº†ä¸€ç§å« <strong><code>isa-swizzling</code></strong> çš„æŠ€æœ¯ã€‚isa æŒ‡é’ˆå°±æ˜¯æŒ‡å‘ç±»çš„æŒ‡é’ˆï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå±æ€§æ³¨å†Œäº†è§‚å¯Ÿè€…åï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆçš„å°±æŒ‡å‘äº†ä¸€ä¸ªç³»ç»Ÿä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä¸­é—´ç±»ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ç±»ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œç³»ç»Ÿä¸ºæˆ‘ä»¬é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•ã€‚ä½ å¯ä»¥é€šè¿‡ <code>object_getClass(id obj)</code> æ–¹æ³•è·å¾—å¯¹è±¡çœŸå®çš„ç±»,åœ¨ addObserver å‰ååˆ†åˆ«æ‰“å°ï¼Œå°±å¯ä»¥çœ‹åˆ°isaæŒ‡é’ˆè¢«æŒ‡å‘äº†ä¸€ä¸ªä¸­é—´ç±»ã€‚ä¼¼ä¹éƒ½æ˜¯åœ¨åŸæ¥çš„ç±»åå‰é¢åŠ ä¸Š <code>NSKVONotifying_</code></p>
<p>isaæŒ‡é’ˆä¸æ€»æ˜¯æŒ‡å‘çœŸå®çš„ç±»ï¼Œæ‰€ä»¥ä½ ä¸åº”è¯¥ä¾èµ–äº isa æŒ‡é’ˆæ¥åˆ¤æ–­è¿™ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œè€Œåº”è¯¥é€šè¿‡ <code>class</code> æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ã€‚å¦‚æœä½ è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯isaæŒ‡é’ˆï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„åšå®¢ <a href="http://blog.cyrusdev.com/2016/03/10/Objective-C-runtime-%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">Objective-C runtime çš„ç®€å•ç†è§£ä¸ä½¿ç”¨</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrpns.com1.z0.glb.clouddn.com/heading-KVO.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å†…å®¹æ¥è‡ªäºå¯¹å®˜æ–¹æ–‡æ¡£ &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html#//apple_ref/doc/uid/10000177-BCICJDHA&quot;&gt;Key-Value Observing Programming Guide&lt;/a&gt; çš„ç¿»è¯‘ï¼Œä»¥åŠä¸€éƒ¨åˆ†æˆ‘è‡ªå·±çš„ç†è§£å’Œè§£é‡Šï¼Œå¦‚æœæœ‰è¯´é”™çš„åœ°æ–¹è¯·åŠæ—¶è”ç³»æˆ‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;At-a-Glance&quot;&gt;&lt;a href=&quot;#At-a-Glance&quot; class=&quot;headerlink&quot; title=&quot;At a Glance&quot;&gt;&lt;/a&gt;At a Glance&lt;/h2&gt;&lt;p&gt;KVO ä¹Ÿå°±æ˜¯ é”®å€¼è§‚å¯Ÿ ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—å½“æŸä¸ªå¯¹è±¡ç‰¹å®šçš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶èƒ½å¤Ÿé€šçŸ¥åˆ°åˆ«çš„å¯¹è±¡ã€‚è¿™ç»å¸¸ç”¨äº model å’Œ controller ä¹‹é—´çš„é€šä¿¡ã€‚KVOä¸»è¦çš„ä¼˜ç‚¹æ˜¯ä½ ä¸éœ€è¦åœ¨æ¯æ¬¡å±æ€§æ”¹å˜æ—¶æ‰‹åŠ¨å»å‘é€é€šçŸ¥ã€‚å¹¶ä¸”å®ƒæ”¯æŒä¸ºä¸€ä¸ªå±æ€§æ³¨å†Œå¤šä¸ªè§‚å¯Ÿè€…ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ³¨å†Œ-KVO&quot;&gt;&lt;a href=&quot;#æ³¨å†Œ-KVO&quot; class=&quot;headerlink&quot; title=&quot;æ³¨å†Œ KVO&quot;&gt;&lt;/a&gt;æ³¨å†Œ KVO&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¢«è§‚å¯Ÿå¯¹è±¡&lt;/strong&gt; çš„å±æ€§å¿…é¡»æ˜¯ &lt;a href=&quot;file:///Users/hcy/Library/Developer/Shared/Documentation/DocSets/com.apple.adc.documentation.iOS.docset/Contents/Resources/Documents/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-BAJEAIEE&quot;&gt;KVO Compliant&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¿…é¡»ç”¨ &lt;strong&gt;è¢«è§‚å¯Ÿå¯¹è±¡&lt;/strong&gt; çš„ &lt;code&gt;addObserver:forKeyPath:options:context:&lt;/code&gt; æ–¹æ³•æ³¨å†Œè§‚å¯Ÿè€…&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§‚å¯Ÿè€…&lt;/strong&gt; å¿…é¡»å®ç° &lt;code&gt;observeValueForKeyPath:ofObject:change:context:&lt;/code&gt; æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="KVO" scheme="http://yoursite.com/tags/KVO/"/>
    
  </entry>
  
  <entry>
    <title>iOS è½¬åœºæ—¶ appear ä¸ disappear çš„è°ƒç”¨é¡ºåºæ¢ç´¢</title>
    <link href="http://yoursite.com/2016/04/06/iOS-%E8%BD%AC%E5%9C%BA%E6%97%B6-appear-%E4%B8%8E-disappear-%E7%9A%84%E8%B0%83%E7%94%A8%E9%A1%BA%E5%BA%8F%E6%8E%A2%E7%B4%A2/"/>
    <id>http://yoursite.com/2016/04/06/iOS-è½¬åœºæ—¶-appear-ä¸-disappear-çš„è°ƒç”¨é¡ºåºæ¢ç´¢/</id>
    <published>2016-04-06T13:41:52.000Z</published>
    <updated>2016-04-06T13:43:16.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrpns.com1.z0.glb.clouddn.com/heading-Appear&Disappear.png"></p>
<p>æœ€è¿‘å‡ å¤©çœ‹äº†å¥½å¤šäººçš„é¢ç»ï¼Œæ—¶ä¸æ—¶å°±çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>åœ¨Aé¡µé¢è·³è½¬åˆ°Bé¡µé¢çš„è¿‡ç¨‹ä¸­ A çš„ viewDidDisappear æ–¹æ³•å’Œ B çš„ viewDidAppear è°å…ˆè°ƒç”¨ï¼Ÿ</p>
</blockquote>
<p>å…¶å®æˆ‘ä»¥å‰ä¸€ç›´ç†æ‰€å½“ç„¶çš„è®¤ä¸ºå®ƒä»¬çš„é¡ºåºå°±æ˜¯ <code>A-viewDidDisappear</code>  â€“&gt; <code>B-viewDidAppear</code>ï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆæƒ³ï¼Œå°±æ˜¯æ„Ÿè§‰<img src="http://7xs81e.com1.z0.glb.clouddn.com/%E4%B8%80%E8%84%B8%E6%87%B5%E9%80%BC.png" ,="" width="40"></p>
<p>ä»Šå¤©å†™äº†ä¸ªDemoå»æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å®Œå…¨ä¸æ˜¯è‡ªå·±æƒ³è±¡çš„é‚£æ ·ï¼Œæ¯ä¸€ç§è½¬åœº(Push,Presentï¼ŒTabBaråˆ‡æ¢)éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p><a href="https://github.com/Hcy91425/Demo/tree/master/Appear%26Disappear-Sample" target="_blank" rel="external">Demo åœ°å€ Appear&amp;Disappear-Sample</a></p>
</blockquote>
<a id="more"></a>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><hr>
<p>æˆ‘è‡ªå®šä¹‰äº†ä¸¤ä¸ªç±»ï¼Œç»§æ‰¿è‡ªUIViewControllerï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿåˆ†åˆ«å«åš<code>A_ViewController</code>,<code>B_ViewController</code>ï¼Œç„¶åé‡å†™äº†ä¸€ç³»åˆ— <code>appear</code> å’Œ <code>disappear</code> æ–¹æ³•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A  view will appear    %@"</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A  view did  appear    %@"</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillDisappear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillDisappear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A  view will disappear %@"</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidDisappear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidDisappear: animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A  view did  disappear %@"</span>,<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ†åˆ«ç”¨ pushï¼Œ presentï¼Œ ä»¥åŠ tabbar çš„åˆ‡æ¢æ¥æµ‹è¯•ï¼Œç„¶åæŸ¥çœ‹æ‰“å°çš„ç»“æœã€‚</p>
<h3 id="Push-amp-Pop"><a href="#Push-amp-Pop" class="headerlink" title="Push &amp; Pop"></a>Push &amp; Pop</h3><hr>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--------------------------PUSH-----------------------------</span><br><span class="line"></span><br><span class="line"> A  view will disappear &lt;A_ViewController: <span class="number">0x7fa11067a730</span>&gt;</span><br><span class="line"> B  view will appear    &lt;B_ViewController: <span class="number">0x7fa110516530</span>&gt;</span><br><span class="line"> A  view did  disappear &lt;A_ViewController: <span class="number">0x7fa11067a730</span>&gt;</span><br><span class="line"> B  view did  appear    &lt;B_ViewController: <span class="number">0x7fa110516530</span>&gt;</span><br><span class="line"></span><br><span class="line">--------------------------POP-----------------------------</span><br><span class="line"></span><br><span class="line"> B  view will disappear &lt;B_ViewController: <span class="number">0x7fa110516530</span>&gt;</span><br><span class="line"> A  view will appear    &lt;A_ViewController: <span class="number">0x7fa11067a730</span>&gt;</span><br><span class="line"> B  view did  disappear &lt;B_ViewController: <span class="number">0x7fa110516530</span>&gt;</span><br><span class="line"> A  view did  appear    &lt;A_ViewController: <span class="number">0x7fa11067a730</span>&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œçš„è°ƒç”¨é¡ºåºæ˜¯å’Œæˆ‘ä¹‹å‰é¢„æƒ³çš„ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯ </p>
<p><code>A-willDisappear</code> â€“&gt; <code>B-willAppear</code> â€“&gt; <code>A-didDisappear</code> â€“&gt; <code>B-didAppear</code></p>
<h3 id="Present-amp-Dismiss"><a href="#Present-amp-Dismiss" class="headerlink" title="Present &amp; Dismiss"></a>Present &amp; Dismiss</h3><hr>
<p>åœ¨æ¨¡æ€çš„è½¬åœºä¸­å°±æœ‰ä¸€äº›ä¸ä¸€æ ·çš„äº‹äº†ã€‚æˆ‘ä»¬çŸ¥é“æ¨¡æ€è½¬åœºæœ‰å¥½å¤šç§styleï¼Œå…¶ä¸­æœ‰ä¸¤ç§æˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„çš„<code>UIModalPresentationCustom</code>,<code>UIModalPresentationOverFullScreen</code>ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹é™¤äº†è¿™ä¸¤ç§styleä»¥å¤–çš„è½¬åœºï¼Œä»–ä»¬çš„è°ƒç”¨é¡ºåºæ˜¯æ€æ ·çš„ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-----------------------NormalPresent------------------------</span><br><span class="line"></span><br><span class="line"> A  view will disappear &lt;A_ViewController: <span class="number">0x7fc2a14ac490</span>&gt;</span><br><span class="line"> B  view will appear    &lt;B_ViewController: <span class="number">0x7fc2a152a880</span>&gt;</span><br><span class="line"> B  view did  appear    &lt;B_ViewController: <span class="number">0x7fc2a152a880</span>&gt;</span><br><span class="line"> A  view did  disappear &lt;A_ViewController: <span class="number">0x7fc2a14ac490</span>&gt;</span><br><span class="line"></span><br><span class="line">-------------------------DISMISS----------------------------</span><br><span class="line"></span><br><span class="line"> B  view will disappear &lt;B_ViewController: <span class="number">0x7fc2a152a880</span>&gt;</span><br><span class="line"> A  view will appear    &lt;A_ViewController: <span class="number">0x7fc2a14ac490</span>&gt;</span><br><span class="line"> A  view did  appear    &lt;A_ViewController: <span class="number">0x7fc2a14ac490</span>&gt;</span><br><span class="line"> B  view did  disappear &lt;B_ViewController: <span class="number">0x7fc2a152a880</span>&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…¶å®å·²ç»å’Œpushçš„è½¬åœºä¸ä¸€æ ·äº†ã€‚æ™®é€šæ¨¡æ€çš„è½¬åœºçš„é¡ºåºæ˜¯è¿™æ ·çš„</p>
<p><code>A-willDisappear</code> â€“&gt; <code>B-willAppear</code> â€“&gt; <code>B-didAppear</code> â€“&gt; <code>A-didDisappear</code></p>
<p>å†çœ‹çœ‹å‰é¢æåˆ°çš„é‚£ä¸¤ç§ç‰¹æ®Šçš„æ¨¡æ€è½¬åœºã€‚å› ä¸ºåœ¨è¿™ä¸¤ç§æ–¹å¼çš„è½¬åœºä¸‹Açš„viewæ˜¯ä¸ä¼šæ¶ˆå¤±çš„ï¼Œæ‰€ä»¥æ‰€æœ‰ä¸Aæœ‰å…³çš„ appear æˆ– disappear æ–¹æ³•éƒ½ä¸ä¼šè¢«è°ƒç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-----------------------CustomPresent------------------------</span><br><span class="line"></span><br><span class="line"> B  view will appear    &lt;B_ViewController: <span class="number">0x7f960249bac0</span>&gt;</span><br><span class="line"> B  view did  appear    &lt;B_ViewController: <span class="number">0x7f960249bac0</span>&gt;</span><br><span class="line"></span><br><span class="line">-------------------------DISMISS----------------------------</span><br><span class="line"></span><br><span class="line"> B  view will disappear &lt;B_ViewController: <span class="number">0x7f960249bac0</span>&gt;</span><br><span class="line"> B  view did  disappear &lt;B_ViewController: <span class="number">0x7f960249bac0</span>&gt;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥åœ¨è¿™ä¸¤ç§styleä¸‹åªæœ‰<code>B-willAppear</code> â€“&gt; <code>B-didAppear</code></p>
<h3 id="TabBaråˆ‡æ¢"><a href="#TabBaråˆ‡æ¢" class="headerlink" title="TabBaråˆ‡æ¢"></a>TabBaråˆ‡æ¢</h3><hr>
<p>TabBar çš„åˆ‡æ¢ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„é¡ºåº</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">B  view will appear    &lt;B_ViewController: <span class="number">0x7f88cbed7160</span>&gt;</span><br><span class="line">A  view will disappear &lt;A_ViewController: <span class="number">0x7f88cbed6680</span>&gt;</span><br><span class="line">A  view did  disappear &lt;A_ViewController: <span class="number">0x7f88cbed6680</span>&gt;</span><br><span class="line">B  view did  appear    &lt;B_ViewController: <span class="number">0x7f88cbed7160</span>&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸pushä¸åŒçš„æ˜¯ï¼ŒTabBarä¸‹ï¼Œä¼šå…ˆè°ƒç”¨ B çš„ willAppearï¼Œå†è°ƒç”¨ A çš„ willDisappear</p>
<p>æ‰€ä»¥TabBarçš„é¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p>
<p><code>B-willAppear</code> â€“&gt; <code>A-willDisappear</code> â€“&gt; <code>A-didDisappear</code> â€“&gt; <code>B-didAppear</code></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><hr>
<p>åœ¨æ¯ä¸€ç§è½¬åœºä¸‹ï¼Œappear ä¸ disappear éƒ½æœ‰ä¸€äº›ä¸ä¸€æ ·çš„é¡ºåºï¼Œä¸€å®šè¦åˆ†æ¸…æ¥šï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®ºã€‚</p>
<p>Pushï¼š <code>A-willDisappear</code>â€“&gt;<code>B-willAppear</code>â€“&gt;<code>A-didDisappear</code>â€“&gt;<code>B-didAppear</code></p>
<p>Presentï¼š <code>A-willDisappear</code>â€“&gt;<code>B-willAppear</code>â€“&gt;<code>B-didAppear</code>â€“&gt;<code>A-didDisappear</code></p>
<p>CustomPresentï¼š <code>B-willAppear</code>â€“&gt;<code>B-didAppear</code></p>
<p>TabBarï¼š <code>B-willAppear</code>â€“&gt;<code>A-willDisappear</code>â€“&gt;<code>A-didDisappear</code>â€“&gt;<code>B-didAppear</code></p>
<h2 id="ç–‘æƒ‘"><a href="#ç–‘æƒ‘" class="headerlink" title="ç–‘æƒ‘"></a>ç–‘æƒ‘</h2><hr>
<p>ä¸ºä»€ä¹ˆè¦æŠŠè¿™ä¸ªè¿‡ç¨‹å¼„çš„è¿™ä¹ˆå¤æ‚ï¼Ÿç›®å‰è¿˜æ²¡æœ‰æƒ³æ³•ï¼Œå¦‚æœæœ‰çŸ¥é“çš„æœ‹å‹ï¼Œå¸Œæœ›å‘ŠçŸ¥ã€‚<img src="http://7xs81e.com1.z0.glb.clouddn.com/%E4%B8%80%E8%84%B8%E6%87%B5%E9%80%BC.png" ,="" width="40"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src = &quot;http://7xrpns.com1.z0.glb.clouddn.com/heading-Appear&amp;Disappear.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘å‡ å¤©çœ‹äº†å¥½å¤šäººçš„é¢ç»ï¼Œæ—¶ä¸æ—¶å°±çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨Aé¡µé¢è·³è½¬åˆ°Bé¡µé¢çš„è¿‡ç¨‹ä¸­ A çš„ viewDidDisappear æ–¹æ³•å’Œ B çš„ viewDidAppear è°å…ˆè°ƒç”¨ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶å®æˆ‘ä»¥å‰ä¸€ç›´ç†æ‰€å½“ç„¶çš„è®¤ä¸ºå®ƒä»¬çš„é¡ºåºå°±æ˜¯ &lt;code&gt;A-viewDidDisappear&lt;/code&gt;  â€“&amp;gt; &lt;code&gt;B-viewDidAppear&lt;/code&gt;ï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆæƒ³ï¼Œå°±æ˜¯æ„Ÿè§‰&lt;img src=&quot;http://7xs81e.com1.z0.glb.clouddn.com/%E4%B8%80%E8%84%B8%E6%87%B5%E9%80%BC.png&quot;, width = 40&gt;&lt;/p&gt;
&lt;p&gt;ä»Šå¤©å†™äº†ä¸ªDemoå»æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å®Œå…¨ä¸æ˜¯è‡ªå·±æƒ³è±¡çš„é‚£æ ·ï¼Œæ¯ä¸€ç§è½¬åœº(Push,Presentï¼ŒTabBaråˆ‡æ¢)éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Hcy91425/Demo/tree/master/Appear%26Disappear-Sample&quot;&gt;Demo åœ°å€ Appear&amp;amp;Disappear-Sample&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="UIKit å­¦ä¹ " scheme="http://yoursite.com/categories/UIKit-%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="viewDidAppear" scheme="http://yoursite.com/tags/viewDidAppear/"/>
    
  </entry>
  
  <entry>
    <title>åˆæ¬¡æ¥è§¦ RunLoop</title>
    <link href="http://yoursite.com/2016/03/24/%E5%88%9D%E6%AC%A1%E6%8E%A5%E8%A7%A6-RunLoop/"/>
    <id>http://yoursite.com/2016/03/24/åˆæ¬¡æ¥è§¦-RunLoop/</id>
    <published>2016-03-24T03:24:25.000Z</published>
    <updated>2016-03-24T03:26:09.000Z</updated>
    
    <content type="html"><![CDATA[<div align="center"><img src="http://7xrpns.com1.z0.glb.clouddn.com/heading-RunLoop.png"></div>

<p>æœ€è¿‘çœ‹äº†ä¸¤ä½å¤§ç¥å…³äºRunLoopçš„ä¸€äº›èµ„æ–™ï¼Œå¯¹RunLoopç®—æ˜¯æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œåœ¨è¿™é‡Œæ•´ç†æ€»ç»“ä¸€ä¸‹è‡ªå·±å¯¹äºRunLoopçš„ç†è§£ã€‚å¦‚æœæˆ‘æœ‰ç†è§£é”™çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶å¸®æˆ‘æŒ‡å‡ºã€‚æˆ‘çœ‹çš„æ˜¯ <a href="http://weibo.com/239801242" target="_blank" rel="external">@ibireme</a> çš„åšå®¢å’Œ <a href="http://weibo.com/u/1364395395" target="_blank" rel="external">@æˆ‘å°±å«Sunnyæ€ä¹ˆäº†</a> çš„è§†é¢‘ï¼Œé“¾æ¥åœ¨ä¸‹é¢ã€‚</p>
<blockquote>
<p><a href="http://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="external">æ·±å…¥ç†è§£RunLoop</a></p>
<p><a href="http://v.youku.com/v_show/id_XODgxODkzODI0.html" target="_blank" rel="external">iOSçº¿ä¸‹åˆ†äº«ã€ŠRunLoopã€‹by å­™æº@sunnyxx</a></p>
</blockquote>
<a id="more"></a>
<h2 id="ä»€ä¹ˆæ˜¯RunLoop"><a href="#ä»€ä¹ˆæ˜¯RunLoop" class="headerlink" title="ä»€ä¹ˆæ˜¯RunLoop"></a>ä»€ä¹ˆæ˜¯RunLoop</h2><hr>
<p>è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œèƒ½å¤Ÿè®©æ•´ä¸ªç¨‹åºä¸€ç›´è¿è¡Œç€ä¸ä¼šé€€å‡ºï¼Œæ¥æ”¶ç”¨æˆ·çš„ä¿¡æ¯ã€‚å½“ç„¶è¿™ä¸ªå¾ªç¯æ˜¯ä¸€ä¸ªååˆ†å¤æ‚çš„å¾ªç¯ã€‚</p>
<h2 id="RunLoopä¸çº¿ç¨‹çš„å…³ç³»"><a href="#RunLoopä¸çº¿ç¨‹çš„å…³ç³»" class="headerlink" title="RunLoopä¸çº¿ç¨‹çš„å…³ç³»"></a>RunLoopä¸çº¿ç¨‹çš„å…³ç³»</h2><hr>
<p>æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªè‡ªå·±çš„mainå‡½æ•°ï¼Œå½“è¿™ä¸ªmainå‡½æ•°æ‰§è¡Œå®Œåè¿™ä¸ªçº¿ç¨‹ä¹Ÿå°±æ²¡äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™è¿™ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ª RunLoopã€‚ä½†æ˜¯åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™å¹¶æ²¡æœ‰ RunLoop ï¼Œåªæœ‰å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡å»è·å–è¿™ä¸ªçº¿ç¨‹çš„ RunLoop æ—¶ï¼Œæ‰ä¼šåˆ›å»ºã€‚</p>
<h2 id="RunLoopçš„ç»“æ„"><a href="#RunLoopçš„ç»“æ„" class="headerlink" title="RunLoopçš„ç»“æ„"></a>RunLoopçš„ç»“æ„</h2><hr>
<p>æ¯ä¸ª RunLoop ä¸­æœ‰ä¸€ä¸ªé›†åˆå…¶ä¸­å­˜æ”¾äº†è‹¥å¹²ä¸ª Modeï¼Œä¸€ä¸ª RunLoop åªèƒ½åœ¨ä¸€ç§ Mode ä¸‹è¿è¡Œï¼Œå¦‚æœéœ€è¦åˆ‡æ¢é‚£ä¹ˆä¹…è¦é€€å‡º Loop å†é‡æ–°æŒ‡å®šä¸€ä¸ª Mode è¿›å…¥ã€‚æ¯ä¸ª Mode ä¸­åˆæœ‰è‹¥å¹²ä¸ª item ï¼Œæ€»å…±æœ‰ä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ <code>Source</code>,<code>Timer</code>,<code>Observer</code>ã€‚å…ˆè¯´ç®€å•çš„</p>
<h3 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h3><p>Timer å°±æ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ NSTimer ä¸å®ƒç´§å¯†ç›¸å…³ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªä½œä¸ºå›è°ƒçš„å‡½æ•°æŒ‡é’ˆï¼Œå½“å®ƒåŠ å…¥åˆ° RunLoop åï¼Œæ¯æ¬¡åˆ°é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒã€‚</p>
<h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>Observer å°±æ˜¯è§‚å¯Ÿè€…ï¼Œå®ƒä¹ŸåŒ…å«ä¸€ä¸ªå›è°ƒï¼Œå½“ RunLoop çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒã€‚RunLoop æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">CF_OPTIONS</span><span class="params">(CFOptionFlags, CFRunLoopActivity)</span> </span>&#123;</span><br><span class="line">    kCFRunLoopEntry         = (<span class="number">1U</span>L &lt;&lt; <span class="number">0</span>), </span><br><span class="line">    kCFRunLoopBeforeTimers  = (<span class="number">1U</span>L &lt;&lt; <span class="number">1</span>),</span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1U</span>L &lt;&lt; <span class="number">2</span>), </span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1U</span>L &lt;&lt; <span class="number">5</span>), </span><br><span class="line">    kCFRunLoopAfterWaiting  = (<span class="number">1U</span>L &lt;&lt; <span class="number">6</span>), </span><br><span class="line">    kCFRunLoopExit          = (<span class="number">1U</span>L &lt;&lt; <span class="number">7</span>), </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>Sourceå°±æ¯”è¾ƒéš¾ç†è§£äº†ã€‚åæ­£æˆ‘è‡ªå·±æ²¡æœ‰å¼„æ˜ç™½ï¼Œè¿˜æ˜¯å¼•ç”¨ä¸€ä¸‹<a href="http://weibo.com/239801242" target="_blank" rel="external">@ibireme</a>çš„åŸè¯å§ã€‚</p>
<blockquote>
<p>CFRunLoopSourceRef æ˜¯äº‹ä»¶äº§ç”Ÿçš„åœ°æ–¹ã€‚Sourceæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šSource0 å’Œ Source1ã€‚</p>
<p>Source0 åªåŒ…å«äº†ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒå¹¶ä¸èƒ½ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚ä½¿ç”¨æ—¶ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨ CFRunLoopSourceSignal(source)ï¼Œå°†è¿™ä¸ª Source æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ CFRunLoopWakeUp(runloop) æ¥å”¤é†’ RunLoopï¼Œè®©å…¶å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚</p>
<p>Source1 åŒ…å«äº†ä¸€ä¸ª mach_port å’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œè¢«ç”¨äºé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ã€‚è¿™ç§ Source èƒ½ä¸»åŠ¨å”¤é†’ RunLoop çš„çº¿ç¨‹</p>
</blockquote>
<h3 id="CFRunLoopMode-å’Œ-CFRunLoop-çš„ç»“æ„"><a href="#CFRunLoopMode-å’Œ-CFRunLoop-çš„ç»“æ„" class="headerlink" title="CFRunLoopMode å’Œ CFRunLoop çš„ç»“æ„"></a>CFRunLoopMode å’Œ CFRunLoop çš„ç»“æ„</h3><p>æˆ‘è§‰å¾—çœ‹äº†ä¸‹é¢è¿™ä¸¤ä¸ªç»“æ„ä½“åï¼Œå¯¹äº RunLoop çš„ç†è§£ä¼šæ˜æœ—å¾ˆå¤šã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __CFRunLoopMode &#123;</span><br><span class="line">    CFStringRef _name;            <span class="comment">// Mode Name</span></span><br><span class="line">    CFMutableSetRef _sources0;    <span class="comment">// Set</span></span><br><span class="line">    CFMutableSetRef _sources1;    <span class="comment">// Set</span></span><br><span class="line">    CFMutableArrayRef _observers; <span class="comment">// Array</span></span><br><span class="line">    CFMutableArrayRef _timers;    <span class="comment">// Array</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> __CFRunLoop &#123;</span><br><span class="line">    CFMutableSetRef _commonModes;     <span class="comment">// Set</span></span><br><span class="line">    CFMutableSetRef _commonModeItems; <span class="comment">// Set&lt;Source/Observer/Timer&gt;</span></span><br><span class="line">    CFRunLoopModeRef _currentMode;    <span class="comment">// Current Runloop Mode</span></span><br><span class="line">    CFMutableSetRef _modes;           <span class="comment">// Set</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>__CFRunLoop</code> ä¸­æœ‰ä¸€ä¸ª <code>_modes</code> ç”¨æ¥å­˜æ”¾è¿™ä¸ª RunLoop ä¸­çš„æ‰€æœ‰ Modeã€‚è¿˜æœ‰ä¸€ä¸ª <code>_currentMode</code> ç”¨æ¥æ ‡è®°å½“å‰çš„ Modeã€‚è€Œåœ¨ <code>_CFRunLoopMode</code> ä¸­é™¤äº† <code>_name</code> å°±æ˜¯é‚£ä¸‰ç§ itemï¼Œåº”è¯¥å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚</p>
<p>éœ€è¦ä¸€æçš„æ˜¯åœ¨ <code>__CGRunLoop</code> ä¸­æœ‰ <code>CFMutableSetRef _commonModes;</code> <code>CFMutableSetRef _commonModeItems;</code> è¿™ä¸ªä¸¤ä¸ªç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª Mode æ ‡è®°ä¸º <code>Common</code>ã€‚ è¿™æ ·æ¯æ¬¡ RunLoop å†…å®¹æ”¹å˜æ—¶éƒ½ä¼šæŠŠ _commonModeItems é‡Œçš„ items å…¨éƒ¨åŒæ­¥åˆ°æ ‡è®°äº† Common çš„ Mode ä¸­ã€‚åœ¨åé¢è®² timer çš„ä¾‹å­æ—¶æˆ‘ä»¬è¿˜ä¼šå†æåˆ°ã€‚</p>
<h3 id="RunLoop-çš„å†…éƒ¨é€»è¾‘"><a href="#RunLoop-çš„å†…éƒ¨é€»è¾‘" class="headerlink" title="RunLoop çš„å†…éƒ¨é€»è¾‘"></a>RunLoop çš„å†…éƒ¨é€»è¾‘</h3><p>è¿˜æ˜¯å¼•ç”¨ä¸€ä¸‹<a href="http://weibo.com/239801242" target="_blank" rel="external">@ibireme</a>çš„å›¾ç‰‡ï¼Œååˆ†çš„ç›´è§‚æ˜äº†ã€‚</p>
<p><img src="http://7xrpns.com1.z0.glb.clouddn.com/RunLoop_1.png" alt=""></p>
<h2 id="RunLoop-åº”ç”¨"><a href="#RunLoop-åº”ç”¨" class="headerlink" title="RunLoop åº”ç”¨"></a>RunLoop åº”ç”¨</h2><hr>
<h3 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h3><p>åœ¨æˆ‘åˆšåˆšå­¦ iOS çš„æ—¶å€™ï¼Œä¸€æ¬¡å¶ç„¶çŸ¥é“äº† NSTimer è¿™ä¸ªä¸œè¥¿åï¼Œé«˜å…´çš„ç”¨å®ƒæ¨¡ä»¿äº†ä¸€ä¸ªç³»ç»Ÿçš„è®¡æ—¶å™¨ã€‚æºç åœ¨ä¸€æ¬¡æ•´ç†çš„æ—¶å€™è¢«æˆ‘åˆ äº†ã€‚ã€‚åªèƒ½çœ‹çœ‹æˆªå›¾äº†ï¼š</p>
<div align="center"><img src="http://7xrpns.com1.z0.glb.clouddn.com/timer1.PNG" ,="" width="500"></div>

<p>æœ¬æ¥æŒºå¼€å¿ƒçš„ï¼Œç»“æœä¸€æ»šåŠ¨ä¸‹é¢çš„è¡¨æ ¼ï¼ŒWHATï¼Ÿï¼è®¡æ—¶å™¨æ€ä¹ˆä¸åŠ¨äº†ï¼Ÿï¼Ÿ <img src="http://7xs81e.com1.z0.glb.clouddn.com/%E4%B8%80%E8%84%B8%E6%87%B5%E9%80%BC.png" alt=""></p>
<p>åæ¥ä¹ŸæŸ¥äº†è§£å†³åŠæ³•ï¼Œä¸è¿‡ä¸€ç›´æ²¡ææ‡‚ä¸ºä»€ä¹ˆã€‚ç°åœ¨çŸ¥é“äº† RunLoop åæ€»ç®—æ˜¯æ˜ç™½äº†ã€‚</p>
<p>åœ¨ä¸»çº¿ç¨‹ä¸­æœ‰é¢„ç½®ä¸¤ä¸ª Modeï¼Œä¸€ä¸ªæ˜¯ Defaultï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ UITrackingRunLoopModeï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªModeéƒ½æ ‡è®°äº† Commonã€‚è¿™ä¸ª Mode åœ¨ ScrollView æ»šåŠ¨æ—¶ä¼šåˆ‡æ¢ï¼Œç”¨æ¥ä¿è¯æ»šåŠ¨çš„æµç•…ã€‚è€Œæˆ‘ä»¬æ³¨å†Œ timer ä½¿ç”¨çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">0.1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(timerAction) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<p>ä¼šé»˜è®¤æŠŠè¿™ä¸ª timer æ³¨å†Œåˆ°å½“å‰ RunLoop çš„ DefaultMode ä¸­ï¼Œé‚£ä¹ˆæ»šåŠ¨çš„æ—¶å€™ Mode ä¸€åˆ‡æ¢ timer å¾ˆæ˜¾ç„¶å°±æ²¡æ³•å·¥ä½œäº†ã€‚è§£å†³åŠæ³•ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><p>æŠŠtimeræ³¨å†Œåˆ°<code>UITrackingRunLoopMode</code>æˆ–è€…<code>NSRunLoopCommonModes</code>(æ·»åŠ åˆ° CommonModes ä¸­å°±ç›¸å½“äºè‡ªåŠ¨æ·»åŠ åˆ°äº†<code>UITrackingRunLoopMode</code>)ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒé€‰ä¸€</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:_timer forMode:<span class="built_in">UITrackingRunLoopMode</span>];</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:_timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŠŠtimeræ·»åŠ åˆ°å­çº¿ç¨‹çš„ RunLoop ä¸­ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆModeéƒ½ä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"com.cyrusdev.queue"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">   <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">       _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">0.1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(timerAction) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">       [[<span class="built_in">NSRunLoop</span> currentRunLoop] run]; <span class="comment">// ä¸€å®šè¦åœ¨æ³¨å†Œtimerä¹‹åè®© RunLoop è·‘èµ·æ¥</span></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æˆ‘å†™äº†ä¸€ä¸ªDemoï¼Œåœ°å€åœ¨è¿™é‡Œï¼Œå¯ä»¥æ„Ÿå—ä¸€ä¸‹ï¼š</p>
<blockquote>
<p><a href="https://github.com/Hcy91425/Demo" target="_blank" rel="external">RunLoopDemo</a></p>
</blockquote>
<h3 id="AutoreleasePool"><a href="#AutoreleasePool" class="headerlink" title="AutoreleasePool"></a>AutoreleasePool</h3><p>åœ¨ App å¯åŠ¨åï¼Œç³»ç»Ÿä¼šåœ¨ä¸»çº¿ç¨‹çš„ RunLoop é‡Œæ³¨å†Œä¸¤ä¸ª Observerã€‚</p>
<p>ç¬¬ä¸€ä¸ª Observer ç›‘å¬ <code>kCFRunLoopEntry</code> ä¹Ÿå°±æ˜¯å³å°†è¿›å…¥ RunLoop çš„çŠ¶æ€ï¼Œåœ¨è¿™é‡Œä¼šåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚</p>
<p>ç¬¬äºŒä¸ª Observer ç›‘å¬ <code>kCFRunLoopBeforeWaiting</code> ä»¥åŠ <code>kCFRunLoopExit</code> ä¸¤ä¸ªçŠ¶æ€ã€‚åœ¨ RunLoop å³å°†è¿›å…¥ä¼‘çœ æ—¶é‡Šæ”¾æ—§æ± ï¼Œåˆ›å»ºæ–°æ± ã€‚åœ¨ RunLoop è¦é€€å‡ºæ—¶é‡Šæ”¾æ± å­ã€‚</p>
<h3 id="è®©ä¸€ä¸ªå­çº¿ç¨‹ä¸€ç›´è¿è¡Œ"><a href="#è®©ä¸€ä¸ªå­çº¿ç¨‹ä¸€ç›´è¿è¡Œ" class="headerlink" title="è®©ä¸€ä¸ªå­çº¿ç¨‹ä¸€ç›´è¿è¡Œ"></a>è®©ä¸€ä¸ªå­çº¿ç¨‹ä¸€ç›´è¿è¡Œ</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="comment">// åˆ›å»ºå­çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">self</span>.thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(threadMain) object:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">self</span>.thread start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)threadMain &#123;</span><br><span class="line">    [[<span class="built_in">NSThread</span> currentThread] setName:<span class="string">@"myThread"</span>]; </span><br><span class="line">    <span class="built_in">NSRunLoop</span> *runLoop = [<span class="built_in">NSRunLoop</span> currentRunLoop];</span><br><span class="line">    [runLoop addPort:[<span class="built_in">NSMachPort</span> port] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">    [runLoop run];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘åœ¨ myThread çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ª RunLoopï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¸ä¼šè‡ªåŠ¨é”€æ¯äº†ã€‚æˆ‘ä»¬å¯ä»¥æš‚åœç¨‹åºçœ‹ä¸€ä¸‹å®ƒçš„çº¿ç¨‹å †æ ˆï¼š</p>
<div align="center"><img src="http://7xrpns.com1.z0.glb.clouddn.com/%E7%BA%BF%E7%A8%8B%E5%A0%86%E6%A0%88.png" ,="" width="500"></div>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><hr>
<p>å¯¹äº RunLoop çš„äº†è§£å…¶å®è¿˜å¾ˆæµ…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå¤§æ¦‚çš„ç»“æ„ï¼Œä¸è¿‡äº†è§£äº†è¿™äº›å†…å®¹å¯¹äºæ•´ä¸ªAppè¿è¡Œçš„è¿‡ç¨‹è¿˜æ˜¯ä¼šæ›´åŠ æ·±å…¥ä¸€äº›äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://7xrpns.com1.z0.glb.clouddn.com/heading-RunLoop.png&quot;&gt;&lt;/div&gt;

&lt;p&gt;æœ€è¿‘çœ‹äº†ä¸¤ä½å¤§ç¥å…³äºRunLoopçš„ä¸€äº›èµ„æ–™ï¼Œå¯¹RunLoopç®—æ˜¯æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œåœ¨è¿™é‡Œæ•´ç†æ€»ç»“ä¸€ä¸‹è‡ªå·±å¯¹äºRunLoopçš„ç†è§£ã€‚å¦‚æœæˆ‘æœ‰ç†è§£é”™çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶å¸®æˆ‘æŒ‡å‡ºã€‚æˆ‘çœ‹çš„æ˜¯ &lt;a href=&quot;http://weibo.com/239801242&quot;&gt;@ibireme&lt;/a&gt; çš„åšå®¢å’Œ &lt;a href=&quot;http://weibo.com/u/1364395395&quot;&gt;@æˆ‘å°±å«Sunnyæ€ä¹ˆäº†&lt;/a&gt; çš„è§†é¢‘ï¼Œé“¾æ¥åœ¨ä¸‹é¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.ibireme.com/2015/05/18/runloop/&quot;&gt;æ·±å…¥ç†è§£RunLoop&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://v.youku.com/v_show/id_XODgxODkzODI0.html&quot;&gt;iOSçº¿ä¸‹åˆ†äº«ã€ŠRunLoopã€‹by å­™æº@sunnyxx&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="RunLoop" scheme="http://yoursite.com/tags/RunLoop/"/>
    
  </entry>
  
  <entry>
    <title>iOS è‡ªå®šä¹‰è½¬åœºåŠ¨ç”» åˆçª¥</title>
    <link href="http://yoursite.com/2016/03/18/iOS-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB-%E5%88%9D%E7%AA%A5/"/>
    <id>http://yoursite.com/2016/03/18/iOS-è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»-åˆçª¥/</id>
    <published>2016-03-18T08:55:42.000Z</published>
    <updated>2016-03-24T03:29:52.000Z</updated>
    
    <content type="html"><![CDATA[<div align="center"><img src="http://7xrpns.com1.z0.glb.clouddn.com/heading-customTransition.png"></div>

<p>è¿™ä¸¤å¤©å­¦ä¹ äº†ä¸€ä¸‹è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»çš„å†…å®¹ï¼Œåˆšå¼€å§‹çœ‹çš„æ—¶å€™è¢«è¿™å‡ ä¸ªåˆé•¿åˆå¾ˆç›¸ä¼¼çš„åè®®å¼„çš„æ™•å¤´è½¬å‘ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å†™ä¸€ç¯‡æµ…æ˜¾æ˜“æ‡‚çš„å…¥é—¨æ–‡ç« ã€‚æœ¬æ–‡çš„å†…å®¹ä¼šæ¯”è¾ƒåŸºç¡€ï¼Œä¸ä¼šæ¶‰åŠçš„å¾ˆæ·±çš„ï¼Œå°±åƒé¢˜ç›®è¯´çš„<code>åˆçª¥</code>ã€‚é€šè¿‡æœ¬æ–‡å¯ä»¥ç”¨æœ€ç®€å•çš„æ–¹å¼å®ç°æœ€ç®€å•çš„è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ã€‚å¦‚æœä½ éœ€è¦æ›´åŠ æ·±å…¥çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<a id="more"></a>
<blockquote>
<p><a href="https://developer.apple.com/library/prerelease/ios/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html" target="_blank" rel="external">Customizing the Transition Animations</a></p>
</blockquote>
<p><strong>æœ¬æ–‡ä¸­çš„ Demo å¯ä»¥ä» <a href="https://github.com/Hcy91425/Demo" target="_blank" rel="external">è¿™é‡Œ</a> ä¸‹è½½</strong></p>
<hr>
<p>åœ¨è®²ä¸»è¦çš„å†…å®¹ä¹‹å‰æˆ‘ä»¬éœ€è¦åˆ†æ¸…å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>presentingViewController</li>
<li>presentedViewController</li>
<li>fromViewController</li>
<li>toViewController</li>
</ul>
<p><code>presentingVC</code>å’Œ<code>presentedVC</code>çš„æ¦‚å¿µæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå‰è€…å°±æ˜¯ <strong>æ‰§è¡Œpresent</strong> åŠ¨ä½œçš„é‚£ä¸ªæ§åˆ¶å™¨ï¼Œè€Œåè€…å°±æ˜¯ <strong>è¢«present</strong> çš„é‚£ä¸ªæ§åˆ¶å™¨ï¼Œè¿™ä¸¤ä¸ªæ§åˆ¶å™¨çš„èº«ä»½æ˜¯å§‹ç»ˆä¸ä¼šæ”¹å˜çš„ã€‚</p>
<p><code>fromVC</code>å’Œ<code>toVC</code>æ˜¯ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼Œåœ¨æ‰§è¡Œ <strong>present</strong> çš„æ—¶å€™<code>presentingVC</code>å°±æ˜¯<code>fromVC</code>ï¼Œè€Œ<code>presentedVC</code>å°±æ˜¯<code>toVC</code>ã€‚åœ¨ <strong>dismiss</strong> çš„æ—¶å€™å°±è¦åä¸€åäº†<code>presentedVC</code>æ˜¯<code>fromVC</code>,è€Œ<code>presentingVC</code>æ˜¯<code>toVC</code>ã€‚å®˜æ–¹æœ‰ä¸€å¼ å›¾æ˜¯è¿™æ ·çš„ï¼š</p>
<div align="center"><img src="http://7xrpns.com1.z0.glb.clouddn.com/from&to.png" width="400"></div>

<h2 id="æ™®é€š-view-controller-è‡ªå®šä¹‰è½¬åœº"><a href="#æ™®é€š-view-controller-è‡ªå®šä¹‰è½¬åœº" class="headerlink" title="æ™®é€š view controller è‡ªå®šä¹‰è½¬åœº"></a>æ™®é€š view controller è‡ªå®šä¹‰è½¬åœº</h2><hr>
<p>æˆ‘ä»¬å…ˆä»¥æ™®é€šçš„ view controller ä¸ºä¾‹å­ï¼Œè®² present å’Œ dismiss çš„è½¬åœºã€‚å¾€ç®€å•äº†è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ 3 ä¸ªåè®®å°±å¯ä»¥å®ç°è‡ªå®šä¹‰è½¬åœºã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIViewControllerContextTransitioning</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIViewControllerAnimatedTransitioning</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIViewControllerTransitioningDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªåè®®<code>UIViewControllerContextTransitioning</code> å®ç°äº†è¿™ä¸ªåè®®çš„å¯¹è±¡ï¼Œæˆ‘å®ƒä¸º<code>è½¬åœºä¸Šä¸‹æ–‡</code>ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè½¬åœºä¸Šä¸‹æ–‡ä¸ç”¨æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œç”±ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å¾ˆå¤šè½¬åœºç›¸å…³çš„ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘åªåˆ—ä¸¾å‡ ä¸ªé‡è¦çš„å±æ€§æˆ–æ–¹æ³•ï¼Œå…¶ä»–çš„çœ‹åå­—å’Œæ³¨é‡Šä¹Ÿèƒ½å¾ˆå®¹æ˜“çŸ¥é“å®ƒä»¬çš„ç”¨é€”ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰€æœ‰è¦æ‰§è¡ŒåŠ¨ç”»çš„ view éƒ½è¦åŠ å…¥åˆ° containerView</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)containerView;	</span><br><span class="line"><span class="comment">// é€šè¿‡ key æ¥è¿”å›è½¬åœºå‰ï¼Œè½¬åœºåçš„ view controller</span></span><br><span class="line"><span class="comment">// UITransitionContextFromViewControllerKey</span></span><br><span class="line"><span class="comment">// UITransitionContextToViewControllerKey</span></span><br><span class="line">- (<span class="built_in">UIViewController</span> *)viewControllerForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"><span class="comment">// å¯ä»¥å¾—åˆ°å‚ä¸è½¬åœºçš„ view controller èµ·å§‹å’Œç»“æŸæ—¶çš„ frameï¼Œä¸€èˆ¬æ¥è¯´é€šè¿‡ fromVC çš„åˆ°èµ·å§‹çš„ï¼Œé€šè¿‡ toVC çš„åˆ°ç»“æŸæ—¶çš„</span></span><br><span class="line">- (<span class="built_in">CGRect</span>)initialFrameForViewController:(<span class="built_in">UIViewController</span> *)vc;</span><br><span class="line">- (<span class="built_in">CGRect</span>)finalFrameForViewController:(<span class="built_in">UIViewController</span> *)vc;</span><br><span class="line"><span class="comment">// åœ¨è½¬åœºåŠ¨ç”»ç»“æŸï¼Œæˆ–è€…å–æ¶ˆæ—¶è¦é€šçŸ¥ç³»ç»Ÿæ˜¯å¦å®Œæˆ</span></span><br><span class="line">- (<span class="keyword">void</span>)completeTransition:(<span class="built_in">BOOL</span>)didComplete;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªåè®®<code>UIViewControllerAnimatedTransitioning</code> è´Ÿè´£çš„æ˜¯è½¬åœºåŠ¨ç”»çš„å†…å®¹ï¼Œæˆ‘æŠŠå®ç°äº†è¿™ä¸ªåè®®çš„å¯¹è±¡ç§°ä½œ<code>åŠ¨ç”»æ§åˆ¶å™¨</code>ã€‚å®ƒæœ‰ä¸¤ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ï¼š<code>- (NSTimeInterval)transitionDuration:</code>å’Œ<code>- (void)animateTransition:</code>ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ç”¨æ¥è¿”å›åŠ¨ç”»çš„æ—¶é•¿ï¼Œè€Œç¬¬äºŒä¸ªæ–¹æ³•å°±æ˜¯å®ç°åŠ¨ç”»çš„è¿‡ç¨‹ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ª<code>è½¬åœºä¸Šä¸‹æ–‡</code>ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥å–åˆ°å¾ˆå¤šè½¬åœºçš„ä¿¡æ¯ï¼Œç„¶åè¿›è¡ŒåŠ¨ç”»ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªåè®®<code>UIViewControllerTransitioningDelegate</code> æˆ‘ä»¬éœ€è®¾ç½®<code>presentedVC</code>çš„<code>transitioningDelegate</code>å±æ€§ä¸ºä¸€ä¸ªå®ç°äº†è¿™ä¸ªåè®®çš„å¯¹è±¡ã€‚æˆ‘ä»¬ç°åœ¨åªè¦å…ˆå…³æ³¨è¿™ä¸ªåè®®çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› present åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented presentingController:(<span class="built_in">UIViewController</span> *)presenting sourceController:(<span class="built_in">UIViewController</span> *)source;</span><br><span class="line"><span class="comment">// è¿”å› dismiss åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ present å’Œ dismiss åŠ¨ç”»æ§åˆ¶å™¨å†™æˆä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å†…éƒ¨é€šè¿‡ä¸€äº›é€»è¾‘åˆ¤æ–­æ¥æ‰§è¡Œå¯¹åº”çš„åŠ¨ç”»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åˆ†æˆä¸¤ä¸ªå¯¹è±¡ã€‚</p>
<p>åœ¨çŸ¥é“äº†ä¸Šé¢è¿™äº›å†…å®¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸€èµ·æ¥å†™ä¸€ä¸ª demo æ¥å­¦ä¹ è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»äº†ã€‚</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><hr>
<p>å…ˆå†™ä¸¤ä¸ª view controllerï¼Œåˆ†åˆ«æ˜¯ presentingVC å’Œ presentedVCï¼Œå†…å®¹åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘å°±ä¸è´´ä¸¤ä»½äº†ã€‚åªæœ‰<code>buttonClicked</code>æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ presentï¼Œ ä¸€ä¸ªæ˜¯ dismissã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PresentingViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    button.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">30</span>);</span><br><span class="line">    button.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [button setTitle:<span class="string">@"present view controller"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonClicked) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buttonClicked &#123;</span><br><span class="line">    PresentedViewController *presentedVC = [PresentedViewController new];</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:presentedVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----- in PresentedViewController.m -----</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonClicked &#123;</span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®Œæˆè¿™äº›åæˆ‘ä»¬çš„ç¨‹åºå°±èƒ½å®ç°è½¬åœºäº†ï¼Œåªä¸è¿‡æ˜¯ç³»ç»Ÿé»˜è®¤çš„è½¬åœºæ–¹å¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å†™ä¸€ä¸ªè‡ªå·±çš„åŠ¨ç”»æ§åˆ¶å™¨ï¼Œä¸ºäº†åŒºåˆ†å’Œç³»ç»Ÿçš„åŠ¨ç”»ï¼Œæˆ‘ä»¬çš„åŠ¨ç”»é€‰æ‹©<code>ä»ä¸Šå¾€ä¸‹</code>åˆ’å‡ºçš„è½¬åœºæ–¹å¼ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç±»ï¼Œè®©å®ƒéµå¾ª<code>UIViewControllerAnimatedTransitioning</code>åè®®ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AnimationController.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AnimationController</span> : <span class="title">NSObject</span>&lt;<span class="title">UIViewControllerAnimatedTransitioning</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// AnimationController.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AnimationController</span></span></span><br><span class="line"><span class="comment">// è½¬åœºçš„æ—¶é—´</span></span><br><span class="line">- (<span class="built_in">NSTimeInterval</span>)transitionDuration:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è½¬åœºåŠ¨ç”»å®ç°</span></span><br><span class="line">- (<span class="keyword">void</span>)animateTransition:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ key å–åˆ° fromVC å’Œ toVC</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *fromVC = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextFromViewControllerKey</span>];</span><br><span class="line">    <span class="built_in">UIViewController</span> *toVC = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextToViewControllerKey</span>];</span><br><span class="line">    <span class="comment">// æŠŠ toVC åŠ å…¥åˆ° containerView</span></span><br><span class="line">    <span class="built_in">UIView</span> *containerView = [transitionContext containerView];</span><br><span class="line">    [containerView addSubview:toVC.view];</span><br><span class="line">    <span class="comment">// ä¸€äº›åŠ¨ç”»è¦ç”¨çš„çš„æ•°æ®</span></span><br><span class="line">    <span class="built_in">CGRect</span> finalFrame = [transitionContext finalFrameForViewController:toVC];</span><br><span class="line">    <span class="built_in">NSTimeInterval</span> duration = [<span class="keyword">self</span> transitionDuration:transitionContext];</span><br><span class="line">    <span class="comment">// åŠ¨ç”»è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (toVC.isBeingPresented) &#123;</span><br><span class="line">        toVC.view.frame = <span class="built_in">CGRectOffset</span>(finalFrame, <span class="number">0</span>, -finalFrame.size.height);</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration</span><br><span class="line">                         animations:^&#123;</span><br><span class="line">                             toVC.view.frame = finalFrame;</span><br><span class="line">                         &#125;</span><br><span class="line">                         completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">                             <span class="comment">// ç»“æŸåè¦é€šçŸ¥ç³»ç»Ÿ</span></span><br><span class="line">                             [transitionContext completeTransition:<span class="literal">YES</span>];</span><br><span class="line">                         &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fromVC.isBeingDismissed) &#123;</span><br><span class="line">        [containerView sendSubviewToBack:toVC.view];</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration</span><br><span class="line">                         animations:^&#123;</span><br><span class="line">                             fromVC.view.frame = <span class="built_in">CGRectOffset</span>(finalFrame, <span class="number">0</span>, -finalFrame.size.height);</span><br><span class="line">                         &#125;</span><br><span class="line">                         completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">                             <span class="comment">// dismiss åŠ¨ç”»æ·»åŠ äº†æ‰‹åŠ¿åå¯èƒ½å‡ºç°è½¬åœºå–æ¶ˆçš„çŠ¶æ€ï¼Œæ‰€ä»¥è¦æ ¹æ®çŠ¶æ€æ¥åˆ¤å®šæ˜¯å¦å®Œæˆè½¬åœº</span></span><br><span class="line">                             <span class="built_in">BOOL</span> isComplete = ![transitionContext transitionWasCancelled];</span><br><span class="line">                             [transitionContext completeTransition:isComplete];</span><br><span class="line">                         &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿”å›äº†åŠ¨ç”»çš„æ—¶é—´ 0.8 ç§’</li>
<li>ç¬¬äºŒä¸ªæ–¹æ³•<ul>
<li>å…ˆé€šè¿‡ key å–åˆ° fromVC å’Œ toVCã€‚</li>
<li>ç„¶åæŠŠ toVC çš„ view åŠ å…¥åˆ° containerView ä¸­ ï¼ŒfromVC çš„ view æ˜¯æœ¬æ¥å°±åœ¨ containerView ä¸­çš„</li>
<li>åŠ¨ç”»çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤å—ï¼Œåˆ†åˆ«æ˜¯ present åŠ¨ç”» å’Œ dismiss åŠ¨ç”»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ UIViewController è‡ªå¸¦çš„ <code>isBeingPresented</code> å’Œ  <code>isBeingDismissed</code> å±æ€§æ¥åˆ¤æ–­å½“å‰æ˜¯é‚£ç§ç±»å‹çš„è½¬åœºã€‚åŠ¨ç”»çš„è¿‡ç¨‹å°±å¯ä»¥è‡ªå·±å‘æŒ¥æƒ³è±¡åŠ›äº†ã€‚åœ¨åŠ¨ç”»ç»“æŸåè¦é€šçŸ¥ç³»ç»Ÿå®Œæˆè½¬åœºï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºç¨åæˆ‘ä»¬è¦ç»™ dismiss æ·»åŠ æ‰‹åŠ¿é©±åŠ¨ï¼Œæ‰€ä»¥è½¬åœºå­˜åœ¨å–æ¶ˆçš„å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡<code>[transitionContext transitionWasCancelled]</code>æ¥å¾—åˆ°è½¬åœºçš„çŠ¶æ€ï¼Œå†åˆ¤æ–­æ˜¯å¦é€šçŸ¥ç³»ç»Ÿè½¬åœºå®Œæˆã€‚</li>
</ul>
</li>
</ul>
<p>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬è¦é€šè¿‡<code>UIViewControllerTransitioningDelegate</code>æŠŠ<code>åŠ¨ç”»æ§åˆ¶å™¨</code>å’Œ<code>è§†å›¾æ§åˆ¶å™¨</code>è”ç³»èµ·æ¥ã€‚æˆ‘ä»¬è¦ç»™<code>PresentingViewController</code>æ·»åŠ ä¸€äº›å†…å®¹ã€‚</p>
<p>å…ˆè®© <code>presentingVC</code> éµå¾ª <code>UIViewControllerTransitioningDelegate</code> åè®®ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PresentingViewController</span> ()&lt;<span class="title">UIViewControllerTransitioningDelegate</span>&gt;</span></span><br><span class="line"><span class="comment">// åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt; animationController;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨<code>- (void)viewDidLoad</code>ä¸­åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ <code>_animationController = [AnimationController new];</code>ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">    _animationController = [AnimationController new];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åœ¨ <code>- (void)buttonClicked</code>æ–¹æ³•ä¸­è®¾ç½®<code>presentedVC</code>çš„ä»£ç†</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)buttonClicked &#123;</span><br><span class="line">    PresentedViewController *presentedVC = [PresentedViewController new];</span><br><span class="line">    <span class="comment">// è®¾ç½® presented view controller çš„è½¬åœºä»£ç†</span></span><br><span class="line">    presentedVC.transitioningDelegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:presentedVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæ·»åŠ ä¸¤ä¸ªä»£ç†æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› present åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented presentingController:(<span class="built_in">UIViewController</span> *)presenting sourceController:(<span class="built_in">UIViewController</span> *)source &#123;</span><br><span class="line">    <span class="keyword">return</span> _animationController;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› dismiss åŠ¨ç”»æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed &#123;</span><br><span class="line">    <span class="keyword">return</span> _animationController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è½¬åœºåŠ¨ç”»äº†ğŸ˜€</p>
<h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><p>presentedVC çš„ modalPresentationStyle é»˜è®¤ä¸º<code>UIModalPresentationFullScreen</code>,è¿™ç§æƒ…å†µä¸‹åœ¨è½¬åœºå®Œæˆåç³»ç»Ÿä¼šè‡ªåŠ¨éšè— presentingVC çš„ view ã€‚å¦‚æœæˆ‘ä»¬è®¾ç½®äº† <code>UIModalPresentationCustom</code>é‚£ä¹ˆè½¬åœºå®Œæˆåï¼ŒpresentingVC çš„ view ä¸ä¼šéšè—ã€‚ä¸€èˆ¬æ¥è¯´åœ¨åŠ¨ç”»çš„æ—¶å€™æˆ‘ä»¬éƒ½ä¼šæŠŠ toVC çš„ view åŠ å…¥åˆ° containerView ä¸­ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹æ‰§è¡Œ dismiss çš„æ—¶å€™æˆ‘ä»¬ä¸èƒ½æŠŠ toVC.viewï¼ˆpresentingVC.viewï¼‰ åŠ å…¥åˆ° containerView ä¸­ï¼Œå› ä¸ºè¿™ä¸ª view å¹¶ç”±ç³»ç»Ÿé¢å¤–ç®¡ç†ï¼Œå¦‚æœæˆ‘ä»¬æ”¹å˜äº†å®ƒï¼Œé‚£å°±æœ‰å¯èƒ½æŠŠä»åŸæ¥çš„è§†å›¾å±‚æ¬¡ä¸­ç§»é™¤è€Œå¯¼è‡´å®ƒæ¶ˆå¤±ä¸è§ã€‚</p>
<h3 id="äº¤äº’å¼è½¬åœº"><a href="#äº¤äº’å¼è½¬åœº" class="headerlink" title="äº¤äº’å¼è½¬åœº"></a>äº¤äº’å¼è½¬åœº</h3><hr>
<p>å®ç°äº¤äº’å¼çš„è½¬åœºéœ€è¦åœ¨<code>UIViewControllerTransitioningDelegate</code>çš„åè®®æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªå®ç°äº†<code>UIViewControllerInteractiveTransitioning</code>çš„å¯¹è±¡ã€‚å®˜æ–¹å·²ç»ç»™æˆ‘ä»¬å°è£…å¥½äº†ä¸€ä¸ª<code>UIPercentDrivenInteractiveTransition</code>ç±»ï¼Œæˆ‘ä»¬åªè¦ç»§æ‰¿è¿™ä¸ªç±»åœ¨åŠ å…¥æˆ‘ä»¬è‡ªå·±çš„ä¸€äº›å†…å®¹å°±å¯ä»¥å®ç°äº¤äº’å¼è½¬åœºã€‚æœ‰å‡ ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°è½¬åœºçŠ¶æ€</span></span><br><span class="line">- (<span class="keyword">void</span>)updateInteractiveTransition:(<span class="built_in">CGFloat</span>)percentComplete;</span><br><span class="line"><span class="comment">// å–æ¶ˆè½¬åœº</span></span><br><span class="line">- (<span class="keyword">void</span>)cancelInteractiveTransition;</span><br><span class="line"><span class="comment">// å®Œæˆè½¬åœº</span></span><br><span class="line">- (<span class="keyword">void</span>)finishInteractiveTransition;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è½¬åœºå‘ç”Ÿæ—¶ï¼Œå¦‚æœè¿”å›äº†<code>äº¤äº’æ§åˆ¶å™¨</code>ï¼Œä½†æ˜¯å´æ²¡æœ‰é€šè¿‡äº¤äº’çš„æ–¹å¼æ¥æ‰§è¡Œè½¬åœºï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹å°±å¡ä½ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™äº¤äº’æ§åˆ¶å™¨æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥ç›‘å¬å½“å‰æ˜¯å¦æ˜¯é€šè¿‡æ‰‹åŠ¿é©±åŠ¨ï¼Œå¦‚æœä¸æ˜¯æˆ‘ä»¬å°±è¿”å›ä¸€ä¸ª nilï¼Œè¿™æ ·å°±ä¸ä¼šæ‰§è¡Œäº¤äº’å¼è½¬åœºï¼Œè€Œåªä¼šæ‰§è¡Œæ™®é€šçš„åŠ¨ç”»è½¬åœºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// InteractionController.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">InteractionController</span> : <span class="title">UIPercentDrivenInteractiveTransition</span></span></span><br><span class="line"><span class="comment">// æ ‡è®°æ˜¯å¦æ˜¯äº¤äº’è½¬åœº</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, getter=isInteracting)<span class="built_in">BOOL</span> interacting;</span><br><span class="line"><span class="comment">// ä¸€äº›åˆå§‹åŒ–å·¥ä½œ</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForViewController:(<span class="built_in">UIViewController</span> *)viewController;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// InteractionController.m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">InteractionController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>)<span class="built_in">UIViewController</span> *presentedVC;	<span class="comment">// æ³¨æ„æ˜¯å¼±å¼•ç”¨</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="built_in">BOOL</span> shouldComplete;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">InteractionController</span></span></span><br><span class="line"><span class="comment">// ç»™ viewController çš„ view æ·»åŠ æ‰‹åŠ¿</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForViewController:(<span class="built_in">UIViewController</span> *)viewController &#123;</span><br><span class="line">    _presentedVC = viewController;</span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *panGesture = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panGestureAction:)];</span><br><span class="line">    [viewController.view addGestureRecognizer:panGesture];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)panGestureAction:(<span class="built_in">UIPanGestureRecognizer</span> *)gestureRecognizer &#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [gestureRecognizer translationInView:gestureRecognizer.view.superview];</span><br><span class="line">    <span class="comment">// åŠ¨ç”»çš„ç™¾åˆ†æ¯”</span></span><br><span class="line">    <span class="built_in">CGFloat</span> percent = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (gestureRecognizer.state) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateBegan</span>:</span><br><span class="line">            <span class="comment">// è®¾ç½®äº¤äº’çŠ¶æ€ä¸º YES</span></span><br><span class="line">            _interacting = <span class="literal">YES</span>;</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¿å¼€å§‹æ—¶è¦è°ƒç”¨ dismiss</span></span><br><span class="line">            [_presentedVC dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateChanged</span>:</span><br><span class="line">            <span class="comment">// è®¡ç®—ç™¾åˆ†æ¯”</span></span><br><span class="line">            percent = -translation.y/_presentedVC.view.bounds.size.height;</span><br><span class="line">            <span class="comment">// æ›´æ–°è½¬åœºçš„è¿›åº¦ ä¼ å…¥çš„å‚æ•°å€¼è¦åœ¨ 0.0~1.0 ä¹‹é—´</span></span><br><span class="line">            [<span class="keyword">self</span> updateInteractiveTransition:percent];</span><br><span class="line">            <span class="comment">// å¦‚æœæ»‘åŠ¨è¶…è¿‡ 30% å°±è§†ä¸ºè½¬åœºå®Œæˆ</span></span><br><span class="line">            _shouldComplete = (percent &gt; <span class="number">0.3</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateCancelled</span>:</span><br><span class="line">            _interacting = <span class="literal">NO</span>;</span><br><span class="line">            [<span class="keyword">self</span> cancelInteractiveTransition];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateEnded</span>:</span><br><span class="line">            _interacting = <span class="literal">NO</span>;</span><br><span class="line">            <span class="keyword">if</span> (_shouldComplete) &#123;</span><br><span class="line">                [<span class="keyword">self</span> finishInteractiveTransition];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                [<span class="keyword">self</span> cancelInteractiveTransition];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šå·²ç»å†™å¾—å¾ˆè¯¦ç»†äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨å®Œæˆæˆ–è€…å–æ¶ˆçš„æ—¶å€™ä¸€å®šè¦è°ƒç”¨å¯¹åº”çš„æ–¹æ³•æ¥é€šçŸ¥ç³»ç»Ÿã€‚å®Œæˆäº†è¿™ä¸ªç±»åæˆ‘ä»¬éœ€è¦å†æ¬¡ä¿®æ”¹ <code>PresentingViewController</code>çš„å†…å®¹ã€‚    </p>
<p>å†æ·»åŠ ä¸€ä¸ªå±æ€§</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)InteractionController *interactiveTransition;</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”åœ¨<code>- (void)viewDidLoad</code>ä¸­åˆå§‹åŒ–å®ƒ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº¤äº’æ§åˆ¶å™¨</span></span><br><span class="line">    _interactiveTransition = [InteractionController new];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>- (void)buttonClicked</code>ä¸­æ‰§è¡Œ<code>- (void)prepareForViewController:(UIViewController *)viewController</code>æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)buttonClicked &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æ·»åŠ äº¤äº’</span></span><br><span class="line">    [_interactiveTransition prepareForViewController:presentedVC];</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:presentedVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€åæ·»åŠ åè®®æ–¹æ³•,åœ¨æ–¹æ³•ä¸­è¦é€šè¿‡ <code>isInteracting</code> å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æ‰§è¡Œäº¤äº’å¼è½¬åœºï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å› <code>nil</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› dismiss çš„äº¤äº’æ§åˆ¶å™¨</span></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerInteractiveTransitioning</span>&gt;)interactionControllerForDismissal:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animator &#123;</span><br><span class="line">    <span class="keyword">return</span> _interactiveTransition.isInteracting ? _interactiveTransition : <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºæ™®é€šçš„ view controller çš„è‡ªå®šä¹‰è½¬åœºå°±åˆ°æ­¤ç»“æŸäº†ã€‚å¦‚æœä½ æŒ‰ç…§æ–‡ç« çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥å†™ä¸‹æ¥ï¼Œç›¸ä¿¡ä½ å·²ç»å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„è‡ªå®šä¹‰è½¬åœºã€‚</p>
<h2 id="å®¹å™¨-view-controller-çš„è‡ªå®šä¹‰è½¬åœº"><a href="#å®¹å™¨-view-controller-çš„è‡ªå®šä¹‰è½¬åœº" class="headerlink" title="å®¹å™¨ view controller çš„è‡ªå®šä¹‰è½¬åœº"></a>å®¹å™¨ view controller çš„è‡ªå®šä¹‰è½¬åœº</h2><hr>
<p><code>UINavigationController</code>ï¼Œ<code>UITabBarController</code> éƒ½å±äº å®¹å™¨VCã€‚ä¸æ™®é€šçš„ VC ä¸åŒçš„æ˜¯ï¼Œå®ƒä»¬é€šè¿‡ <code>UINavigationControllerDelegate</code>æˆ–è€…<code>UITabBarControllerDelegate</code>çš„ä»£ç†æ–¹æ³•æ¥è¿”å›<code>åŠ¨ç”»æ§åˆ¶å™¨</code>ï¼Œè€ŒåŠ¨ç”»æ§åˆ¶å™¨çš„å…·ä½“å®ç°ï¼Œå‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æˆ‘æ”¾åœ¨ <a href="https://github.com/Hcy91425/Demo" target="_blank" rel="external">github ä¸Šçš„ Demo</a> ä¸­ï¼Œæœ‰è¿™ä¸‰ç§è‡ªå®šè½¬åœºçš„ä»£ç ï¼Œç”¨çš„åŸºæœ¬ä¸Šæ˜¯åŒä¸€ä¸ª animationController ï¼Œå¦‚æœä½ æŒæ¡äº†å‰é¢çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿå°±ä¸æ˜¯é—®é¢˜äº†ã€‚å…·ä½“çš„ä»£ç æˆ‘å°±ä¸å±•å¼€äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://7xrpns.com1.z0.glb.clouddn.com/heading-customTransition.png&quot;&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸¤å¤©å­¦ä¹ äº†ä¸€ä¸‹è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»çš„å†…å®¹ï¼Œåˆšå¼€å§‹çœ‹çš„æ—¶å€™è¢«è¿™å‡ ä¸ªåˆé•¿åˆå¾ˆç›¸ä¼¼çš„åè®®å¼„çš„æ™•å¤´è½¬å‘ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å†™ä¸€ç¯‡æµ…æ˜¾æ˜“æ‡‚çš„å…¥é—¨æ–‡ç« ã€‚æœ¬æ–‡çš„å†…å®¹ä¼šæ¯”è¾ƒåŸºç¡€ï¼Œä¸ä¼šæ¶‰åŠçš„å¾ˆæ·±çš„ï¼Œå°±åƒé¢˜ç›®è¯´çš„&lt;code&gt;åˆçª¥&lt;/code&gt;ã€‚é€šè¿‡æœ¬æ–‡å¯ä»¥ç”¨æœ€ç®€å•çš„æ–¹å¼å®ç°æœ€ç®€å•çš„è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ã€‚å¦‚æœä½ éœ€è¦æ›´åŠ æ·±å…¥çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="UIKit å­¦ä¹ " scheme="http://yoursite.com/categories/UIKit-%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="è‡ªå®šä¹‰è½¬åœº" scheme="http://yoursite.com/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E5%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C å—ï¼ˆBlockï¼‰çš„ä½¿ç”¨ä¸ç†è§£</title>
    <link href="http://yoursite.com/2016/03/13/Objective-C-%E5%9D%97%EF%BC%88Block%EF%BC%89%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%90%86%E8%A7%A3/"/>
    <id>http://yoursite.com/2016/03/13/Objective-C-å—ï¼ˆBlockï¼‰çš„ä½¿ç”¨ä¸ç†è§£/</id>
    <published>2016-03-13T08:33:30.000Z</published>
    <updated>2016-03-30T02:24:43.000Z</updated>
    
    <content type="html"><![CDATA[<p><div align="center"><img src="http://7xrad5.com1.z0.glb.clouddn.com/heading_block.png"></div></p>
<hr>
<p>å—ï¼ˆBlockï¼‰æ˜¯åœ¨ iOS å¼€å‘ä¸­å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥ä½¿æˆ‘ä»¬ä»£ç çš„ä¸šåŠ¡é€»è¾‘æ›´åŠ çš„ç´§å‡‘ã€‚æœ¬æ–‡ä¼šåˆ†ä¸¤éƒ¨åˆ†æ¥è®²å—ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å—çš„åŸºç¡€çŸ¥è¯†ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å¯¹å—çš„æœ¬è´¨çš„ä¸€äº›ç†è§£ã€‚</p>
<a id="more"></a>
<h2 id="å—çš„åŸºç¡€çŸ¥è¯†"><a href="#å—çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="å—çš„åŸºç¡€çŸ¥è¯†"></a>å—çš„åŸºç¡€çŸ¥è¯†</h2><hr>
<h3 id="å—çš„å£°æ˜"><a href="#å—çš„å£°æ˜" class="headerlink" title="å—çš„å£°æ˜"></a>å—çš„å£°æ˜</h3><p>å—çš„å£°æ˜ç±»ä¼¼äºå‡½æ•°æŒ‡é’ˆï¼Œåªä¸è¿‡æŠŠ * æ¢æˆäº† ^ ã€‚å£°æ˜æ—¶æœ€å‰é¢æ˜¯è¿”å›ç±»å‹ï¼Œä¸­é—´æ˜¯å—åï¼Œæœ€åæ˜¯å‚æ•°ç±»å‹ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returnType (^blockName) (parameters)</span></span><br><span class="line"><span class="keyword">int</span> (^someBlock) (<span class="keyword">int</span>, <span class="keyword">int</span>);</span><br></pre></td></tr></table></figure>
<h3 id="å—çš„å®ç°"><a href="#å—çš„å®ç°" class="headerlink" title="å—çš„å®ç°"></a>å—çš„å®ç°</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ^returnType(parameters)&#123;/*code*/&#125;;</span></span><br><span class="line">^<span class="keyword">int</span>(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">	<span class="keyword">return</span> a+b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­è¿”å›å€¼æ˜¯å¯ä»¥çœç•¥çš„,å®ƒå¯ä»¥è‡ªåŠ¨åˆ¤æ–­ï¼Œå¦‚æœå‚æ•°ä¹Ÿæ˜¯ç©ºçš„è¯æˆ‘ä»¬å¯ä»¥ç®€åŒ–æˆè¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="å—çš„ä½¿ç”¨"><a href="#å—çš„ä½¿ç”¨" class="headerlink" title="å—çš„ä½¿ç”¨"></a>å—çš„ä½¿ç”¨</h3><p>å—çš„ä½¿ç”¨å°±åƒä½¿ç”¨ C å‡½æ•°ä¸€æ ·</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">someBlockï¼ˆ<span class="number">1</span>ï¼Œ<span class="number">2</span>ï¼‰;</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨-typedef-æ¥ç®€åŒ–å—çš„å£°æ˜"><a href="#ç”¨-typedef-æ¥ç®€åŒ–å—çš„å£°æ˜" class="headerlink" title="ç”¨ typedef æ¥ç®€åŒ–å—çš„å£°æ˜"></a>ç”¨ typedef æ¥ç®€åŒ–å—çš„å£°æ˜</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (^CYAddBlock) (<span class="keyword">int</span>, <span class="keyword">int</span>);</span><br><span class="line">CYAddBlock addBlock = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">	<span class="keyword">return</span> a+b;</span><br><span class="line">&#125;;</span><br><span class="line">addBlock(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h3 id="å—èƒ½æ•è·åœ¨å®ƒå£°æ˜èŒƒå›´é‡Œçš„æ‰€æœ‰å˜é‡"><a href="#å—èƒ½æ•è·åœ¨å®ƒå£°æ˜èŒƒå›´é‡Œçš„æ‰€æœ‰å˜é‡" class="headerlink" title="å—èƒ½æ•è·åœ¨å®ƒå£°æ˜èŒƒå›´é‡Œçš„æ‰€æœ‰å˜é‡"></a>å—èƒ½æ•è·åœ¨å®ƒå£°æ˜èŒƒå›´é‡Œçš„æ‰€æœ‰å˜é‡</h3><p>ä½†æ˜¯ä¸èƒ½å†å—ä¸­ä¿®æ”¹æ•è·åˆ°çš„å˜é‡ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä¿®æ”¹ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> (^someBlock) () = ^&#123;</span><br><span class="line">	<span class="keyword">return</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> result = someBlock();	<span class="comment">// result = 0</span></span><br></pre></td></tr></table></figure>
<h3 id="ç”¨-block-ä¿®é¥°å˜é‡ï¼Œå¯ä»¥åœ¨å—ä¸­ä¿®æ”¹å˜é‡çš„å€¼"><a href="#ç”¨-block-ä¿®é¥°å˜é‡ï¼Œå¯ä»¥åœ¨å—ä¸­ä¿®æ”¹å˜é‡çš„å€¼" class="headerlink" title="ç”¨ __block ä¿®é¥°å˜é‡ï¼Œå¯ä»¥åœ¨å—ä¸­ä¿®æ”¹å˜é‡çš„å€¼"></a>ç”¨ __block ä¿®é¥°å˜é‡ï¼Œå¯ä»¥åœ¨å—ä¸­ä¿®æ”¹å˜é‡çš„å€¼</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> (^someBlock) () = ^&#123;</span><br><span class="line">	<span class="keyword">return</span> ++count;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> result = someBlock();	<span class="comment">// result = 1</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®å—åœ¨æ•è·å˜é‡æ—¶åªæ˜¯æ‹·è´äº†ä¸€ä»½å˜é‡çš„å€¼ï¼Œè€Œç”¨ __block ä¿®é¥°åï¼Œæ‹·è´çš„æ˜¯å˜é‡çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åœ¨å—ä¸­ä¿®æ”¹å˜é‡äº†ã€‚è¿™å°±å’Œ C è¯­è¨€ä¸­å‡½æ•°çš„å‚æ•°æ˜¯ç±»ä¼¼çš„é“ç†ã€‚</p>
<h3 id="å°å¿ƒäº§ç”Ÿå¾ªç¯å¼•ç”¨"><a href="#å°å¿ƒäº§ç”Ÿå¾ªç¯å¼•ç”¨" class="headerlink" title="å°å¿ƒäº§ç”Ÿå¾ªç¯å¼•ç”¨"></a>å°å¿ƒäº§ç”Ÿå¾ªç¯å¼•ç”¨</h3><p>åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå—èƒ½ç›´æ¥è®¿é—®å¹¶ä¿®æ”¹å®ä¾‹å˜é‡çš„å€¼ï¼Œä½†æ˜¯ä¸€å®šè¦æ³¨æ„ä¸ç®¡æ˜¯é€šè¿‡ self æ¥è®¿é—®å±æ€§è¿˜æ˜¯ç›´æ¥é€šè¿‡ _instanceVariable æ¥è®¿é—®<strong>éƒ½ä¼šæ•è· self</strong>ã€‚å› ä¸ºåœ¨ç›´æ¥è®¿é—® _instanceVariable ç­‰æ•ˆäºè¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>-&gt;_instanceVariable;</span><br></pre></td></tr></table></figure>
<p>è€Œä¸€æ—¦æ•è·äº†selfï¼Œ æˆ‘ä»¬å°±ä¸€å®šè¦æ³¨æ„<strong>å¾ªç¯å¼•ç”¨</strong>å¯¼è‡´çš„å†…å­˜æ³„éœ²äº†ã€‚æˆ‘ä»¬åœ¨ CYClass ä¸­å£°æ˜äº†ä¸€ä¸ªå—å’Œä¸€ä¸ªå±æ€§ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^CYBlock) ();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CYClass</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *aString;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)CYBlock aBlock;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡å†™å®ƒçš„ init å’Œ dealloc æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CYClass</span></span></span><br><span class="line">- (instancetype)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        _aString = <span class="string">@"Hello Cyrus"</span>;</span><br><span class="line">        _aBlock = ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, _aString);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"CYClass deinit"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç´§æ¥ç€å°±æŠŠå®ƒè®¾ä¸º nil ä¼šå‘ç° dealloc æ–¹æ³•å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å‘ç”Ÿäº†å†…å­˜æ³„éœ²ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CYClass *c = [CYClass new];</span><br><span class="line">c = <span class="literal">nil</span>;</span><br></pre></td></tr></table></figure>
<p>å°±åƒè¿™æ ·ï¼š</p>
<p><img src="http://7xrpns.com1.z0.glb.clouddn.com/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ __weak æ¥æ‰“ç ´è¿™ä¸ªå¾ªç¯ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        _aString = <span class="string">@"Hello Cyrus"</span>;</span><br><span class="line">        __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">        _aBlock = ^&#123;</span><br><span class="line">        	__<span class="keyword">strong</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) strongSelf = weakSelf;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, strongSelf.aString);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰§è¡Œä¹‹å‰çš„ä»£ç å°±ä¼šå‘ç°è¿™ä¸ªå¯¹è±¡æˆåŠŸçš„é”€æ¯äº†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-12</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">24.995</span> BlockExample[<span class="number">4777</span>:<span class="number">111670</span>] CYClass deinit</span><br></pre></td></tr></table></figure>
<h2 id="å—çš„æœ¬è´¨"><a href="#å—çš„æœ¬è´¨" class="headerlink" title="å—çš„æœ¬è´¨"></a>å—çš„æœ¬è´¨</h2><hr>
<h3 id="å—çš„ç»“æ„"><a href="#å—çš„ç»“æ„" class="headerlink" title="å—çš„ç»“æ„"></a>å—çš„ç»“æ„</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨<a href="https://llvm.org/svn/llvm-project/compiler-rt/tags/Apple/Libcompiler_rt-10/BlocksRuntime/Block_private.h" target="_blank" rel="external">è¿™é‡Œ</a>æ‰¾åˆ° Block çš„å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> Block_descriptor &#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> reserved;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">void</span> (*<span class="keyword">copy</span>)(<span class="keyword">void</span> *dst, <span class="keyword">void</span> *src);</span><br><span class="line">    <span class="keyword">void</span> (*dispose)(<span class="keyword">void</span> *);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Block_layout &#123;</span><br><span class="line">    <span class="keyword">void</span> *isa;</span><br><span class="line">    <span class="keyword">int</span> flags;</span><br><span class="line">    <span class="keyword">int</span> reserved; </span><br><span class="line">    <span class="keyword">void</span> (*invoke)(<span class="keyword">void</span> *, ...);</span><br><span class="line">    <span class="keyword">struct</span> Block_descriptor *descriptor;</span><br><span class="line">    <span class="comment">/* Imported variables. */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ° Block_layout ç»“æ„ä½“é‡Œçš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯ä¸€ä¸ª <strong>isa æŒ‡é’ˆ</strong>ï¼Œ æˆ‘ä»¬åº”è¯¥å°±èƒ½çŒœåˆ° <strong>Block ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡</strong>ã€‚ç„¶åå†çœ‹ç¬¬å››ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå« <strong>invoke çš„å‡½æ•°æŒ‡é’ˆ</strong>ï¼Œå®ƒæŒ‡å‘çš„å°±æ˜¯ <strong>Block å…·ä½“å®ç°çš„å‡½æ•°</strong>äº†,è¿™ä¸ªå‡½æ•°è‡³å°‘è¦æ¥å—ä¸€ä¸ª void*  ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å—æœ¬èº«ã€‚å†ä¸‹é¢çš„ descriptor æŒ‡å‘çš„å°±æ˜¯ Block_descriptor ç»“æ„ä½“ï¼Œé‡Œé¢å°±æ˜¯ä¸€äº› Block çš„ä¿¡æ¯ã€‚è€Œåœ¨è¿™äº›å˜é‡ä¸‹é¢å­˜æ”¾çš„å°±æ˜¯ <strong>Block æ•è·çš„é‚£äº›å˜é‡</strong>ã€‚</p>
<h3 id="å—çš„ç±»å‹"><a href="#å—çš„ç±»å‹" class="headerlink" title="å—çš„ç±»å‹"></a>å—çš„ç±»å‹</h3><p>åœ¨ OC ä¸­ä¸€å…±æœ‰3ç§å—ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>å…¨å±€å—ï¼Œä¸ä¼šè®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡</li>
<li>æ ˆå—ï¼Œä¿å­˜åœ¨æ ˆä¸­, å½“å‡½æ•°é€€å‡ºåå°±ä¼šè¢«é”€æ¯ï¼Œé€šè¿‡copyå¯ä»¥å¤åˆ¶åˆ°å †ä¸Š</li>
<li>å †å—ï¼Œä¿å­˜åœ¨å †ä¸­</li>
</ul>
<p>æˆ‘ä»¬åœ¨ MRC çš„ç¯å¢ƒä¸‹è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (^globalBlock)()  = ^&#123; <span class="built_in">NSLog</span>(<span class="string">@"global block"</span>); &#125;;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, globalBlock);</span><br><span class="line">        </span><br><span class="line"><span class="built_in">NSString</span> *str1 = <span class="string">@"stack block"</span>;</span><br><span class="line"><span class="keyword">void</span> (^stackBlcok)() = ^&#123; <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str1); &#125;;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, stackBlcok);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSString</span> *str2 = <span class="string">@"malloc block"</span>;</span><br><span class="line"><span class="keyword">void</span> (^mallockBlock)() = [^&#123; <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str2); &#125; <span class="keyword">copy</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, mallockBlock);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">23</span>:<span class="number">50.676</span> BlockExample[<span class="number">1760</span>:<span class="number">28902</span>] &lt;__<span class="built_in">NSGlobalBlock__</span>: <span class="number">0x1000042b0</span>&gt;</span><br><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">23</span>:<span class="number">50.677</span> BlockExample[<span class="number">1760</span>:<span class="number">28902</span>] &lt;__<span class="built_in">NSStackBlock__</span>: <span class="number">0x7fff5fbff790</span>&gt;</span><br><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">23</span>:<span class="number">50.677</span> BlockExample[<span class="number">1760</span>:<span class="number">28902</span>] &lt;__<span class="built_in">NSMallocBlock__</span>: <span class="number">0x100303fa0</span>&gt;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå’Œæˆ‘ä»¬é¢„æœŸçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬åœ¨æ¢æˆ ARC çš„ç¯å¢ƒä¸‹è¿è¡Œä¸€æ¬¡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">05.767</span> BlockExample[<span class="number">1805</span>:<span class="number">29822</span>] &lt;__<span class="built_in">NSGlobalBlock__</span>: <span class="number">0x1000052f0</span>&gt;</span><br><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">05.768</span> BlockExample[<span class="number">1805</span>:<span class="number">29822</span>] &lt;__<span class="built_in">NSMallocBlock__</span>: <span class="number">0x100400340</span>&gt;</span><br><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">05.769</span> BlockExample[<span class="number">1805</span>:<span class="number">29822</span>] &lt;__<span class="built_in">NSMallocBlock__</span>: <span class="number">0x1004001b0</span>&gt;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°åŸæ¥çš„æ ˆå—ä¹Ÿå˜æˆäº†å †å—ã€‚è¿™æ˜¯å› ä¸ºåœ¨æŠŠä¸€ä¸ªå¿«èµ‹å€¼ç»™ä¸€ä¸ªstrongå¯¹è±¡æ—¶ ARC ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡copyã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥è¿™æ ·ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šæ‰“å°å‡º __NSStackBlock :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str1 = <span class="string">@"stack block"</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, ^&#123; <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str1); &#125;);</span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="number">2016</span><span class="number">-03</span><span class="number">-13</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">06.180</span> BlockExample[<span class="number">1881</span>:<span class="number">32260</span>] &lt;__<span class="built_in">NSStackBlock__</span>: <span class="number">0x7fff5fbff798</span>&gt;</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://7xrad5.com1.z0.glb.clouddn.com/heading_block.png&quot;&gt;&lt;/div&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å—ï¼ˆBlockï¼‰æ˜¯åœ¨ iOS å¼€å‘ä¸­å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥ä½¿æˆ‘ä»¬ä»£ç çš„ä¸šåŠ¡é€»è¾‘æ›´åŠ çš„ç´§å‡‘ã€‚æœ¬æ–‡ä¼šåˆ†ä¸¤éƒ¨åˆ†æ¥è®²å—ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å—çš„åŸºç¡€çŸ¥è¯†ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å¯¹å—çš„æœ¬è´¨çš„ä¸€äº›ç†è§£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C å­¦ä¹ " scheme="http://yoursite.com/categories/Objective-C-%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Block" scheme="http://yoursite.com/tags/Block/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C runtime çš„ç®€å•ç†è§£ä¸ä½¿ç”¨ï¼ˆä¸€ï¼‰</title>
    <link href="http://yoursite.com/2016/03/10/Objective-C-runtime-%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://yoursite.com/2016/03/10/Objective-C-runtime-çš„ç®€å•ç†è§£ä¸ä½¿ç”¨ï¼ˆä¸€ï¼‰/</id>
    <published>2016-03-10T11:49:34.000Z</published>
    <updated>2016-11-13T08:17:41.000Z</updated>
    
    <content type="html"><![CDATA[<div align="center"><img src="http://7xrad5.com1.z0.glb.clouddn.com/heading_runtime1.png"></div>

<hr>
<p>ä¸€å¼€å§‹æ¥è§¦ iOS çš„æ—¶å€™ï¼Œå­¦çš„æ˜¯ Swiftã€‚è¿˜æœ‰ä¸€ä¸ªå­¦æœŸå°±å¤§å››ï¼Œä¸ºäº†å®ä¹ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ç†è§£ iOSï¼Œæœ€è¿‘ä¸€ä¸ªå¤šæœˆå¼€å§‹æ­£å¼å­¦ä¹  Objective-Cã€‚è€Œ runtime â€œè¿è¡Œæ—¶â€ åº”è¯¥ç®—æ˜¯ Objective-C çš„æ ¸å¿ƒæ‰€åœ¨ã€‚æˆ‘è§‰å¾—æœ‰å¿…è¦å¥½å¥½æ¥ç†è§£ä¸€ä¸‹ runtimeã€‚å­¦çš„è¿˜ä¸æ˜¯å¾ˆç²¾ï¼Œä¸»è¦æ˜¯é€šè¿‡çœ‹åˆ«äººçš„åšå®¢å’Œã€ŠEffective Objective-C 2.0ã€‹è¿™æœ¬ä¹¦æ¥å­¦ä¹  runtime ï¼Œå®˜æ–¹æ–‡æ¡£è¿˜æ²¡æœ‰çœ‹è¿‡ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿè¡¥ä¸Šã€‚å¦‚æœæœ‰ä»€ä¹ˆç†è§£çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºã€‚ğŸ˜†</p>
<a id="more"></a>                
<h2 id="Objective-Cä¸­çš„æ¶ˆæ¯åˆ†å‘"><a href="#Objective-Cä¸­çš„æ¶ˆæ¯åˆ†å‘" class="headerlink" title="Objective-Cä¸­çš„æ¶ˆæ¯åˆ†å‘"></a>Objective-Cä¸­çš„æ¶ˆæ¯åˆ†å‘</h2><hr>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[someObject doSomething];</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æˆ‘ä»¬åœ¨ Objective-C ä¸­è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ï¼Œ ä½†å…¶å®è¿™åº”è¯¥ç§°ä½œ<strong>â€œä¼ é€’æ¶ˆæ¯â€ï¼ˆpass a messageï¼‰</strong>ï¼Œç»™ someObject å¯¹è±¡ä¼ é€’ä¸€ä¸ª doSomethingçš„æ¶ˆæ¯ã€‚å› ä¸ºè¿™è¡Œä»£ç åœ¨ç¼–è¯‘æ—¶ä¼šå˜æˆè¿™æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objc_msgSend(someObject, <span class="keyword">@selector</span>(doSomething))</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ª C å‡½æ•°ï¼Œ å£°æ˜åœ¨ objc/message.h å¤´æ–‡ä»¶ä¸­ï¼Œå®ƒæ¥å—ä¸¤ä¸ªåŠä»¥ä¸Šçš„å¯å˜å‚æ•°, ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯æ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨é€‰æ‹©å­ï¼ˆ<a href="#selector">selectorï¼Œåœ¨åé¢æˆ‘ä»¬ä¼šç»†è¯´</a>ï¼‰ï¼Œå¦‚æœè¦è°ƒç”¨çš„æ–¹æ³•è¿˜æœ‰åˆ«çš„å‚æ•°ï¼Œå°±ä¼šè·Ÿåœ¨è¿™ä¸¤ä¸ªå‚æ•°åé¢ã€‚è¿˜æœ‰å…¶ä»–å‡ ä¸ªç±»ä¼¼çš„å‡½æ•°ï¼Œæ¥å¤„ç†ä¸åŒçš„æƒ…å†µï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> objc_msgSend(<span class="keyword">id</span> <span class="keyword">self</span>, SEL op, ...)	<span class="comment">// ç›´æ¥å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">id</span> objc_msgSendSuper(<span class="keyword">struct</span> objc_super *<span class="keyword">super</span>, SEL op, ...)	<span class="comment">// ç»™çˆ¶ç±»å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">void</span> objc_msgSend_stret(<span class="keyword">id</span> <span class="keyword">self</span>, SEL op, ...)	<span class="comment">// è¿”å›å€¼æ˜¯ç»“æ„ä½“æ—¶ï¼Œå¯ä»¥äº¤ç»™è¿™ä¸ªå‡½æ•°å¤„ç†</span></span><br><span class="line"><span class="keyword">double</span> objc_msgSend_fpret(<span class="keyword">id</span> <span class="keyword">self</span>, SEL op, ...)	<span class="comment">// è¿”å›å€¼æ˜¯æµ®ç‚¹æ•°æ—¶ï¼Œå¯ä»¥äº¤ç»™è¿™ä¸ªå‡½æ•°å¤„ç†</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šåœ¨è¿™ä¸ªå¯¹è±¡çš„ç±»ä¸­æ ¹æ® selector æ‰¾åˆ°çœŸæ­£çš„å®ç°å‡½æ•°ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±å†åˆ°å®ƒçš„çˆ¶ç±»ä¸­æ‰¾ï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾ä¸Šå»ï¼Œæœ€ååˆ° NSObject ç±»ä¸­ï¼Œ å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šå¯ç”¨â€œæ¶ˆæ¯è½¬å‘æœºåˆ¶â€ã€‚è¿™ä¸ªæˆ‘ä»¬ä»¥åå†æã€‚</p>
<h4 id="æ¶ˆæ¯åˆ†å‘å›¾ç¤º"><a href="#æ¶ˆæ¯åˆ†å‘å›¾ç¤º" class="headerlink" title="æ¶ˆæ¯åˆ†å‘å›¾ç¤º"></a>æ¶ˆæ¯åˆ†å‘å›¾ç¤º</h4><p><img src="http://7xrpns.com1.z0.glb.clouddn.com/messaging1.gif"></p>
<h2 id="Objective-Cä¸­ç±»çš„æœ¬è´¨"><a href="#Objective-Cä¸­ç±»çš„æœ¬è´¨" class="headerlink" title="Objective-Cä¸­ç±»çš„æœ¬è´¨"></a>Objective-Cä¸­ç±»çš„æœ¬è´¨</h2><hr>
<p>Objective-C ä¸­çš„ç±»å…¶å®æ˜¯ C ä¸­çš„ç»“æ„ä½“ï¼Œå®ƒçš„åŸºæœ¬å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class isa ;</span><br><span class="line">    Class super_class ;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name ;</span><br><span class="line">    <span class="keyword">long</span> version ;</span><br><span class="line">    <span class="keyword">long</span> info ;</span><br><span class="line">    <span class="keyword">long</span> instance_size ;</span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars ;</span><br><span class="line">    <span class="keyword">struct</span> objc_method_list **methodLists ;</span><br><span class="line">    <span class="keyword">struct</span> objc_cache *cache ;</span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols ;</span><br><span class="line">&#125; ;</span><br><span class="line"><span class="comment">/* Use `Class` instead of `struct objc_class *` */</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå˜é‡</p>
<h3 id="Class-isa"><a href="#Class-isa" class="headerlink" title="Class isa"></a>Class isa</h3><blockquote>
<p>isa æŒ‡é’ˆï¼Œè¡¨ç¤ºè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªä»€ä¹ˆç±»ã€‚è€Œ <strong>Class</strong> ç±»å‹ï¼Œ ä¹Ÿå°±æ˜¯ <strong>struct objc_class *</strong> ï¼Œè¿™æ˜¯è‹¹æœåœ¨ä¸‹é¢çš„æ³¨é‡Šä¸­å†™åˆ°çš„ã€‚è¿™è¯´æ˜ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨ç±»å¯¹è±¡ä¸­çš„ isa æŒ‡å‘çš„ç±»å«åš<strong>â€œå…ƒç±»â€</strong>ï¼Œç±»æ–¹æ³•å°±å®šä¹‰åœ¨å…ƒç±»ä¸­ã€‚<br>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¾ˆå¤šçš„å®ä¾‹ï¼Œè¿™äº›å®ä¾‹æœ‰ç€å”¯ä¸€çš„ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè€Œè¿™ä¸ªç±»å¯¹è±¡ä¹Ÿæœ‰ç€å”¯ä¸€çš„ä¸€ä¸ªå…ƒç±»ã€‚</p>
</blockquote>
<h4 id="å®ä¾‹ï¼Œç±»ï¼Œçˆ¶ç±»ï¼Œå…ƒç±»ä¹‹é—´çš„å…³ç³»"><a href="#å®ä¾‹ï¼Œç±»ï¼Œçˆ¶ç±»ï¼Œå…ƒç±»ä¹‹é—´çš„å…³ç³»" class="headerlink" title="å®ä¾‹ï¼Œç±»ï¼Œçˆ¶ç±»ï¼Œå…ƒç±»ä¹‹é—´çš„å…³ç³»"></a>å®ä¾‹ï¼Œç±»ï¼Œçˆ¶ç±»ï¼Œå…ƒç±»ä¹‹é—´çš„å…³ç³»</h4><p><img src="http://7xrpns.com1.z0.glb.clouddn.com/%E7%B1%BB%E5%92%8C%E5%85%83%E7%B1%BB.png"></p>
<h3 id="Class-super-class"><a href="#Class-super-class" class="headerlink" title="Class super_class"></a>Class super_class</h3><blockquote>
<p>super_class æŒ‡å‘çš„å°±æ˜¯å®ƒçš„çˆ¶ç±»ã€‚</p>
</blockquote>
<h3 id="struct-objc-ivar-list-ivars"><a href="#struct-objc-ivar-list-ivars" class="headerlink" title="struct objc_ivar_list *ivars"></a>struct objc_ivar_list *ivars</h3><blockquote>
<p>ivars æŒ‡å‘çš„æ˜¯æˆå‘˜å˜é‡çš„åˆ—è¡¨ã€‚</p>
</blockquote>
<p><span id="selector"></span></p>
<h3 id="struct-objc-method-list-methodLists"><a href="#struct-objc-method-list-methodLists" class="headerlink" title="struct objc_method_list **methodLists"></a>struct objc_method_list **methodLists</h3><blockquote>
<p>methodLists æŒ‡å‘çš„å°±æ˜¯æ–¹æ³•çš„åˆ—è¡¨ã€‚åœ¨ method_list ä¸­å­˜ç€ objc_method ç±»å‹çš„æ•°ç»„ã€‚è€Œ objc_method çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_method &#123;</span><br><span class="line">    SEL method_name ;</span><br><span class="line">    <span class="keyword">char</span> *method_types ;</span><br><span class="line">    IMP method_imp ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">id</span> (*IMP)(<span class="keyword">id</span>, SEL, ...); 	<span class="comment">// IMP å°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>çœ‹åˆ°è¿™ä¸ªç»“æ„ä½“ï¼Œ æˆ‘ä»¬åº”è¯¥å°±å¾ˆæ˜ç¡® selector çš„æ„ä¹‰äº†ã€‚<strong>selector</strong> å…¶å®å°±æ˜¯<strong>æ–¹æ³•çš„ä¸€ä¸ªæ ‡ç¤º</strong>ï¼Œè€Œ <strong>method_imp</strong> æŒ‡å‘çš„æ‰æ˜¯<strong>çœŸæ­£çš„å‡½æ•°å®ç°</strong>ã€‚å½“æˆ‘ä»¬å‘å¯¹è±¡å‘é€æ¶ˆæ¯åï¼Œ runtimeæ ¹æ® selector è¿™ä¸ªæ ‡ç¤ºï¼Œåœ¨method_listä¸­æ‰¾åˆ°å¯¹åº”çš„ objc_methodï¼Œå–åˆ°çœŸæ­£çš„å‡½æ•°çš„åœ°å€ï¼Œå†æ‰§è¡Œã€‚</p>
</blockquote>
<h3 id="struct-objc-cache-cache"><a href="#struct-objc-cache-cache" class="headerlink" title="struct objc_cache *cache"></a>struct objc_cache *cache</h3><blockquote>
<p>cache ç”¨æ¥ç¼“å­˜æœ€è¿‘è°ƒç”¨è¿‡çš„çš„æ–¹æ³•ã€‚ å¦‚æœæ¯æ¬¡å‘å¯¹è±¡å‘é€æ¶ˆæ¯éƒ½è¦éå†ä¸€éæ–¹æ³•åˆ—è¡¨é‚£ä¼šå¾ˆæµªè´¹æ—¶é—´ï¼Œ æ‰€ä»¥ä¼šæŠŠæœ€è¿‘è°ƒç”¨è¿‡çš„æ–¹æ³•æ”¾åœ¨ç¼“å­˜ä¸­ã€‚æ¯ä¸€æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œç¼“å­˜ä¸­æ‰¾ä¸åˆ°å†å»æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾ã€‚</p>
</blockquote>
<h3 id="struct-objc-protocol-list-protocols"><a href="#struct-objc-protocol-list-protocols" class="headerlink" title="struct objc_protocol_list *protocols"></a>struct objc_protocol_list *protocols</h3><blockquote>
<p>protocols æŒ‡å‘åè®®åˆ—è¡¨ã€‚</p>
</blockquote>
<h2 id="Runtimeèƒ½åšä»€ä¹ˆ"><a href="#Runtimeèƒ½åšä»€ä¹ˆ" class="headerlink" title="Runtimeèƒ½åšä»€ä¹ˆ"></a>Runtimeèƒ½åšä»€ä¹ˆ</h2><hr>
<ul>
<li>åŠ¨æ€çš„æ”¹å˜æˆå‘˜å˜é‡çš„å€¼</li>
<li>åœ¨è¿è¡Œæ—¶æ·»åŠ æ–¹æ³•</li>
<li>äº¤æ¢æ–¹æ³•çš„å®ç°</li>
<li>ç»™ä¸€ä¸ªå¯¹è±¡å…³è”å…¶ä»–å¯¹è±¡</li>
<li>æ¶ˆæ¯è½¬å‘</li>
<li><p>ç­‰ç­‰ï¼Œè®¸è®¸å¤šå¤šæˆ‘ä»¬æƒ³ä¸åˆ°çš„åŠŸèƒ½</p>
<p>runtimeçš„ä½¿ç”¨åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­å†è¯¦ç»†è®² ~</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://7xrad5.com1.z0.glb.clouddn.com/heading_runtime1.png&quot; /&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;ä¸€å¼€å§‹æ¥è§¦ iOS çš„æ—¶å€™ï¼Œå­¦çš„æ˜¯ Swiftã€‚è¿˜æœ‰ä¸€ä¸ªå­¦æœŸå°±å¤§å››ï¼Œä¸ºäº†å®ä¹ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ç†è§£ iOSï¼Œæœ€è¿‘ä¸€ä¸ªå¤šæœˆå¼€å§‹æ­£å¼å­¦ä¹  Objective-Cã€‚è€Œ runtime â€œè¿è¡Œæ—¶â€ åº”è¯¥ç®—æ˜¯ Objective-C çš„æ ¸å¿ƒæ‰€åœ¨ã€‚æˆ‘è§‰å¾—æœ‰å¿…è¦å¥½å¥½æ¥ç†è§£ä¸€ä¸‹ runtimeã€‚å­¦çš„è¿˜ä¸æ˜¯å¾ˆç²¾ï¼Œä¸»è¦æ˜¯é€šè¿‡çœ‹åˆ«äººçš„åšå®¢å’Œã€ŠEffective Objective-C 2.0ã€‹è¿™æœ¬ä¹¦æ¥å­¦ä¹  runtime ï¼Œå®˜æ–¹æ–‡æ¡£è¿˜æ²¡æœ‰çœ‹è¿‡ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿè¡¥ä¸Šã€‚å¦‚æœæœ‰ä»€ä¹ˆç†è§£çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºã€‚ğŸ˜†&lt;/p&gt;
    
    </summary>
    
      <category term="Objective-C å­¦ä¹ " scheme="http://yoursite.com/categories/Objective-C-%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="runtime" scheme="http://yoursite.com/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€ç¯‡åšå®¢</title>
    <link href="http://yoursite.com/2016/03/10/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
    <id>http://yoursite.com/2016/03/10/ç¬¬ä¸€ç¯‡åšå®¢/</id>
    <published>2016-03-10T03:04:16.000Z</published>
    <updated>2016-03-18T01:47:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>èŠ±äº†ä¸€ä¸ªæ™šä¸ŠåŠ ä¸Šä¸€ä¸ªä¸Šåˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠè‡ªå·±çš„åšå®¢æ­èµ·æ¥äº†ã€‚ä»¥åè¦å¥½å¥½å­¦ä¹ ï¼Œ è®¤çœŸçš„å†™åšå®¢äº†ã€‚</p>
<p>å—¯ï¼Œ ç¬¬ä¸€ç¯‡åšå®¢å°±æ˜¯è¿™ä¹ˆç®€çŸ­ï¼Œæ‹œæ‹œ~ ğŸ˜†</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;èŠ±äº†ä¸€ä¸ªæ™šä¸ŠåŠ ä¸Šä¸€ä¸ªä¸Šåˆçš„æ—¶é—´ï¼Œç»ˆäºæŠŠè‡ªå·±çš„åšå®¢æ­èµ·æ¥äº†ã€‚ä»¥åè¦å¥½å¥½å­¦ä¹ ï¼Œ è®¤çœŸçš„å†™åšå®¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;å—¯ï¼Œ ç¬¬ä¸€ç¯‡åšå®¢å°±æ˜¯è¿™ä¹ˆç®€çŸ­ï¼Œæ‹œæ‹œ~ ğŸ˜†&lt;/p&gt;

    
    </summary>
    
    
  </entry>
  
</feed>
